<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8"/>

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="keywords" content="yhzdys,æœæ’">
<meta name="description" content="yhzdys,æœæ’">
<meta name="theme-color" content="#222">
<title>å…³äºæœ¬ç«™ | yhzdys&#39;sÂ·notes</title>
<link rel="shortcut icon" href="/favicon.ico?v=1656083350442">
<link rel="stylesheet" href="/media/css/pisces.css">
<link rel="stylesheet" href="/media/fonts/font-awesome.css">
<link href="//fonts.loli.net/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Rosario:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext"
      rel="stylesheet" type="text/css">

<link href="/media/hljs/styles/androidstudio.css"
      rel="stylesheet">

    <script src="https://cdn.staticfile.org/pace/1.0.2/pace.min.js"></script>
    <link href="https://cdn.staticfile.org/pace/1.2.4/themes/black/pace-theme-corner-indicator.css" rel="stylesheet"/>

<link rel="stylesheet" href="/styles/main.css">
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script src="/media/js/jquery.js"></script>
<script src="/media/hljs/highlight.js"></script>
<script src="https://cdn.staticfile.org/velocity/1.5.2/velocity.min.js"></script>
<script src="https://cdn.staticfile.org/velocity/1.5.2/velocity.ui.min.js"></script>
<link rel="stylesheet" href="https://cdn.staticfile.org/KaTeX/0.11.1/katex.min.css"
      integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">


    <script defer src="https://cdn.staticfile.org/KaTeX/0.11.1/katex.min.js"
            integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz"
            crossorigin="anonymous"></script>
    <script defer src="https://cdn.staticfile.org/KaTeX/0.11.1/contrib/auto-render.min.js"
            integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"
            onload="renderMathInElement(document.body);"></script>



    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XDVH3JN2B0"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());
        gtag('config', 'G-XDVH3JN2B0');
    </script>


    <script>
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?e41c72c79749539f41bbd93bbc4c1a00";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>



    <meta name="description" content="å…³äºæœ¬ç«™"/>
    <meta name="keywords" content=""/>
</head>

<body>
<div class="head-top-line"></div>
<div class="header-box">
    
<div class="pisces">
    <header class="header  ">
        <div class="blog-header box-shadow-wrapper bg-color "
             id="header">
            <div class="nav-toggle" id="nav_toggle">
                <div class="toggle-box">
                    <div class="line line-top"></div>
                    <div class="line line-center"></div>
                    <div class="line line-bottom"></div>
                </div>
            </div>
            <div class="site-meta">
                <div class="site-title">
                    
                        <a href="/" class="brand">
                            <span>yhzdys&#39;sÂ·notes</span>
                        </a>
                    
                </div>
                
                    <p class="subtitle"> </p>
                
            </div>
            <nav class="site-nav" id="site_nav">
                <ul id="nav_ul">
                    
                        
                        

                        <li class="nav-item ">
                            
                            
                                <a href="https://blog.yhzdys.com" target="_self">
                                    <i class="fa fa-home"></i> é¦–é¡µ
                                </a>
                            
                        </li>
                    
                        
                        

                        <li class="nav-item ">
                            
                            
                                <a href="https://blog.yhzdys.com/tags" target="_self">
                                    <i class="fa fa-tags"></i> æ ‡ç­¾
                                </a>
                            
                        </li>
                    
                        
                        

                        <li class="nav-item ">
                            
                            
                                <a href="https://blog.yhzdys.com/archives" target="_self">
                                    <i class="fa fa-archive"></i> å½’æ¡£
                                </a>
                            
                        </li>
                    
                        
                        

                        <li class="nav-item ">
                            
                            
                                <a href="https://blog.yhzdys.com/post/about" target="_self">
                                    <i class="fa fa-user"></i> å…³äº
                                </a>
                            
                        </li>
                    
                    
                    
                        <li id="fa_search" class="nav-item">
                            <a href="javascript:void(0);">
                                <i class="fa fa-search"></i> <span class="language" data-lan="search">æœç´¢</span>
                            </a>
                        </li>
                    
                </ul>
            </nav>
        </div>
    </header>
</div>

<script type="text/javascript">

    let showNav = true;

    let navToggle = document.querySelector('#nav_toggle'),
        siteNav = document.querySelector('#site_nav');

    function navClick() {
        let sideBar = document.querySelector('.sidebar');
        let navUl = document.querySelector('#nav_ul');
        navToggle.classList.toggle('nav-toggle-active');
        siteNav.classList.toggle('nav-menu-active');
        if (siteNav.classList.contains('nav-menu-active')) {
            siteNav.style = "height: " + (navUl.children.length * 42) + "px !important";
        } else {
            siteNav.style = "";
        }
    }

    navToggle.addEventListener('click', navClick);
</script>
</div>
<div class="main-continer">
    
    <div
            class="section-layout pisces ">
        <div class="section-layout-wrapper">
            

<div class="sidebar">
    
        <div class="sidebar-box box-shadow-wrapper bg-color right-motion"
             id="sidebar">
            
                <div class="post-list-sidebar">
                    <div class="sidebar-title">
                        <span id="tocSideBar" class="sidebar-title-item sidebar-title-active language" data-lan="index">æ–‡ç« ç›®å½•</span>
                        <span id="metaSideBar" class="sidebar-title-item language" data-lan="preview">ç«™ç‚¹æ¦‚è§ˆ</span>
                    </div>
                </div>
            
            <div class="sidebar-body pisces" id="sidebar_body">
                
                    
                        <div class="post-side-meta" id="post_side_meta">
                            
<div class="sidebar-wrapper box-shadow-wrapper bg-color">
    <div class="sidebar-item">
        <img class="site-author-image right-motion" src="/images/avatar.png"/>
        <p class="site-author-name">yhzdys</p>
        
    </div>
    <div class="sidebar-item side-item-stat right-motion">
        <div class="sidebar-item-box">
            <a href="/archives/">
                
                <span class="site-item-stat-count">4</span>
                <span class="site-item-stat-name language" data-lan="article">æ–‡ç« </span>
            </a>
        </div>
        <div class="sidebar-item-box">
            <a href="/tags/">
                <span class="site-item-stat-count">3</span>
                <span class="site-item-stat-name language" data-lan="tag">æ ‡ç­¾</span>
            </a>
        </div>
    </div>
    
        
    
    
    
        
    
    
    
</div>
                        </div>
                        <div class="post-toc sidebar-body-active" id="post_toc" style="opacity: 1;">
                            <div class="toc-box right-motion">
    <div class="toc-wrapper  no_compress"
         id="toc_wrapper">
        <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E5%85%B3%E4%BA%8E%E6%88%91">å…³äºæˆ‘ğŸ‘Œ</a></li>
<li><a href="#%E8%81%94%E7%B3%BB%E6%96%B9%E5%BC%8F">è”ç³»æ–¹å¼ğŸ“</a></li>
</ul>
</li>
</ul>

    </div>
</div>

<script>
    let lastTop = 0, lList = [], hList = [], postBody, lastIndex = -1;
    let active = 'active-show', activeClass = 'active-current';
    let tocWrapper = document.querySelector('#toc_wrapper');
    let tocContent = tocWrapper.children[0];
    let autoNumber = tocWrapper && tocWrapper.classList.contains('auto-number');

    function addTocNumber(elem, deep) {
        if (!elem) {
            return;
        }
        let prop = elem.__proto__;

        if (prop === HTMLUListElement.prototype) {
            for (let i = 0; i < elem.children.length; i++) {
                addTocNumber(elem.children[i], deep + (i + 1) + '.');
            }
        } else if (prop === HTMLLIElement.prototype) {
            // ä¿å­˜liå…ƒç´ 
            if (elem.children[0] && elem.children[0].__proto__ === HTMLAnchorElement.prototype) {
                lList.push(elem);
            }
            for (let i = 0; i < elem.children.length; i++) {
                let cur = elem.children[i];
                if (cur.__proto__ === HTMLAnchorElement.prototype) {
                    if (autoNumber) {
                        cur.text = deep + ' ' + cur.text;
                    }
                } else if (cur.__proto__ === HTMLUListElement.prototype) {
                    addTocNumber(cur, deep);
                }
            }
        }
    }

    function removeParentActiveClass() {
        let parents = tocContent.querySelectorAll('.' + active)
        parents.forEach(function (elem) {
            elem.classList.remove(active);
        });
    }

    function addActiveClass(index) {
        if (index >= 0 && index < hList.length) {
            lList[index].classList.add(activeClass);
        }
    }

    function removeActiveClass(index) {
        if (index >= 0 && index < hList.length) {
            lList[index].classList.remove(activeClass);
        }
    }

    function addActiveLiElement(elem, parent) {
        if (!elem || elem === parent) {
        } else {
            if (elem.__proto__ === HTMLLIElement.prototype) {
                elem.classList.add(active);
            }
            addActiveLiElement(elem.parentElement, parent);
        }
    }

    function showToc() {
        if (tocWrapper) {
            postBody = document.querySelector('#post_body');
            for (let i = 0; i < postBody.children.length; i++) {
                if (postBody.children[i].__proto__ === HTMLHeadingElement.prototype) {
                    hList.push(postBody.children[i]);
                }
            }
            if (tocWrapper.classList.contains('compress')) {
                tocContent.classList.add('closed');
            } else if (tocWrapper.classList.contains('no_compress')) {
                tocContent.classList.add('expanded');
            } else {
                if (hList.length > 10) {
                    active = 'active-hidden'
                    tocContent.classList.add('closed');
                } else {
                    tocContent.classList.add('expanded');
                }
            }
        }
    }

    (function () {
        // å¤„ç†ä¸æ˜¯ä»#ä¸€çº§æ ‡é¢˜å¼€å§‹ç›®å½•
        if (tocContent.children.length === 1 && tocContent.children[0].__proto__ === HTMLLIElement.prototype) {
            let con = tocContent.children[0].children[0];
            tocContent.innerHTML = con.innerHTML;
        }
        let markdownItTOC = document.querySelector('.markdownIt-TOC');
        let innerHeight = window.innerHeight;
        markdownItTOC.style = `max-height: ${innerHeight - 80 > 0 ? innerHeight - 80 : innerHeight}px`
        addTocNumber(tocContent, '');
    })();

    document.addEventListener('scroll', function (e) {
        if (lList.length <= 0) {
            return;
        }
        let scrollTop = document.scrollingElement.scrollTop + 10;
        let dir;

        if (lastTop - scrollTop > 0) {
            dir = 'up';
        } else {
            dir = 'down';
        }

        lastTop = scrollTop;
        if (scrollTop <= 0) {
            if (lastIndex >= 0 && lastIndex < hList.length) {
                lList[lastIndex].classList.remove(activeClass);
            }
            return;
        }

        let current = 0, hasFind = false;
        for (let i = 0; i < hList.length; i++) {
            if (hList[i].offsetTop > scrollTop) {
                current = i;
                hasFind = true;
                break;
            }
        }
        if (!hasFind && scrollTop > lList[lList.length - 1].offsetTop) {
            current = hList.length - 1;
        } else {
            current--;
        }
        if (dir === 'down') {
            if (current > lastIndex) {
                addActiveClass(current);
                removeActiveClass(lastIndex)
                lastIndex = current;
                removeParentActiveClass();
                lList[current] && addActiveLiElement(lList[current].parentElement, tocContent);
            }
        } else {
            if (current < lastIndex) {
                addActiveClass(current);
                removeActiveClass(lastIndex);
                lastIndex = current;
                removeParentActiveClass();
                lList[current] && addActiveLiElement(lList[current].parentElement, tocContent);
            }
        }
    });

    window.addEventListener('load', function () {
        showToc();
        document.querySelector('#sidebar').style = 'display: block;';
        tocWrapper.classList.add('toc-active');
        setTimeout(function () {
            if ("createEvent" in document) {
                let evt = document.createEvent("HTMLEvents");
                evt.initEvent("scroll", false, true);
                document.dispatchEvent(evt);
            } else {
                document.fireEvent("scroll");
            }
        }, 500)
    })

</script>
                        </div>
                    
                
            </div>
        </div>
    
</div>
<script>
    const SIDEBAR_TITLE_ACTIVE = 'sidebar-title-active';
    const SIDEBAR_BODY_ACTIVE = 'sidebar-body-active';
    const SLIDE_UP_IN = 'slide-up-in';

    let sidebar = document.querySelector('#sidebar'),
        tocSideBar = document.querySelector('#tocSideBar'),
        metaSideBar = document.querySelector('#metaSideBar'),
        postToc = document.querySelector('#post_toc'),
        postSiteMeta = document.querySelector('#post_side_meta'),
        sidebarTitle = document.querySelector('.sidebar-title'),
        sidebarBody = document.querySelector('#sidebar_body');

    tocSideBar && tocSideBar.addEventListener('click', (e) => {
        toggleSidebar(e);
    });

    metaSideBar && metaSideBar.addEventListener('click', (e) => {
        toggleSidebar(e);
    });

    function toggleSidebar(e) {
        let currentTitle = document.querySelector("." + SIDEBAR_TITLE_ACTIVE);
        if (currentTitle == e.srcElement) {
            return;
        }
        let current, showElement, hideElement;
        if (e.srcElement == metaSideBar) {
            showElement = postSiteMeta;
            hideElement = postToc;
        } else if (e.srcElement == tocSideBar) {
            showElement = postToc;
            hideElement = postSiteMeta;
        }
        currentTitle.classList.remove(SIDEBAR_TITLE_ACTIVE);
        e.srcElement.classList.add(SIDEBAR_TITLE_ACTIVE);

        jQuery.Velocity(hideElement, 'stop');
        jQuery.Velocity(hideElement, 'transition.slideUpOut', {
            display: 'none',
            duration: 200,
            complete: function () {
                jQuery.Velocity(showElement, 'transition.slideDownIn', {
                    duration: 200
                });
            }
        })
        hideElement.classList.remove(SIDEBAR_BODY_ACTIVE);
        showElement.classList.add(SIDEBAR_BODY_ACTIVE);
    }

    postToc && postToc.addEventListener('transitionend', function () {
        this.classList.remove(SLIDE_UP_IN);
    });

    if (sidebarBody) {
        if (sidebarBody.classList.contains('pisces') || sidebarBody.classList.contains('gemini')) {
            let hasFix = false;
            let scrollEl = document.querySelector('.main-continer');
            let limitTop = document.querySelector('#nav_ul').children.length * 42 + 162;
            window.addEventListener('scroll', function (e) {
                if (document.scrollingElement.scrollTop >= limitTop) {
                    if (!hasFix) {
                        sidebar.classList.add('sidebar-fixed');
                        hasFix = true;
                    }
                } else {
                    if (hasFix) {
                        sidebar.classList.remove('sidebar-fixed');
                        hasFix = false;
                    }
                }
            });
        }
    }

</script>
            <div class="section-box box-shadow-wrapper">
                <div class="section bg-color post post-page">
                    <section class="post-header">
    <h1 class="post-title">
        <a class="post-title-link" href="https://blog.yhzdys.com/post/about/"> å…³äºæœ¬ç«™ </a>
    </h1>
    <div class="post-meta">
        
        <span class="meta-item pc-show">
      <i class="fa fa-calendar-o"></i>
      <span class="language" data-lan="publish">å‘å¸ƒäº</span>
      <span class="publish-time" data-t="2017-07-18 20:46:38">2017-07-18</span>
      <span class="post-meta-divider pc-show">|</span>
    </span>
        
        <span class="meta-item">
      <i class="fa fa-clock-o"></i>
      <span
      >1<span class="language" data-lan="minute"
          >åˆ†é’Ÿ</span
          ></span
      >
    </span>
        <span class="meta-item">
      <span class="post-meta-divider">|</span>
      <i class="fa fa-file-word-o"></i>
      <span
      >43<span class="pc-show language" data-lan="words"
          >å­—æ•°</span
          ></span
      >
    </span>
        
    </div>
</section>

                    <div class="post-body next-md-body" id="post_body">
                        <p>æ¬¢è¿æ¥åˆ°æˆ‘çš„åšå®¢ï¼Œå¾ˆé«˜å…´é‡è§ä½ ï¼ğŸ˜„</p>
<h2 id="å…³äºæˆ‘">å…³äºæˆ‘ğŸ‘Œ</h2>
<p>17å²åœ¨è¯»é«˜ä¸­ç”Ÿï¼Œä½åœ¨è¡£æŸœé‡Œã€‚</p>
<h2 id="è”ç³»æ–¹å¼">è”ç³»æ–¹å¼ğŸ“</h2>
<p>e-mail: yhzdys@foxmail.com<br>
github: https://github.com/yhzdys</p>

                    </div>
                    
                    
                    
    
        
            <link rel="stylesheet" href="https://cdn.staticfile.org/gitalk/1.7.2/gitalk.min.css">
<script src="https://cdn.staticfile.org/gitalk/1.7.2/gitalk.min.js"></script>

<div id="gitalk-container"></div>

<script>
    var gitalk = new Gitalk({
        clientID: '3ab71fc9c4ac97920d11',
        clientSecret: '112f339bdc8091b7883d6e2e47dcc2bed899b26d',
        repo: 'blog-talk',
        owner: 'yhzdys',
        admin: ['yhzdys'],
        id: (location.pathname).substring(0, 49),
        distractionFreeMode: false
    })
    gitalk.render('gitalk-container')
</script>
        
        
    

                </div>
            </div>
        </div>
    </div>
    <div class="footer-box">
    <footer class="footer">
        <center id="runTimeBox">
            å·²è¿è¡Œ:<span id="run_time"></span>
        </center>
        <span id="busuanzi_container_site_pv">æµè§ˆæ•°:<span id="busuanzi_value_site_pv"></span> æ¬¡</span>
        <span class="post-meta-divider">|</span>
        <span id="busuanzi_container_site_uv">è®¿å®¢æ•°:<span id="busuanzi_value_site_uv"></span> äºº</span>

        <script>
            BirthDay = new Date('2017-07-18 20:46:38');
            if (BirthDay.getTime()) {
                function runTime() {
                    str = "";
                    today = new Date();
                    timeold = today.getTime() - BirthDay.getTime();
                    msPerDay = 24 * 60 * 60 * 1000;
                    e_daysold = timeold / msPerDay;
                    daysold = Math.floor(e_daysold);
                    str += daysold + "å¤©";
                    return str;
                }

                setInterval(function () {
                    $("#run_time").html(runTime());
                }, 1000);
            } else {
                document.querySelector('.footer').removeChild(document.querySelector('#runTimeBox'));
            }
        </script>
        <div class="footerInfo">
            
        </div>
    </footer>
    
    
    <div class="pisces back-to-top" id="back_to_top">
        <i class="fa fa-arrow-up"></i>
        
            <span class="scrollpercent"> <span id="back_to_top_text">0</span>% </span>
        
    </div>
    
    
        
<link rel="stylesheet" href="/media/live2d/css/live2d.css"/>
<div class="box-scale">
    <div id="landlord" style="left: 5px;bottom: -20px;"
         data-key="2f2f55582c6944118a25abc6ef5e723c">
        <canvas id="live2d" width="500" height="560" class="live2d"></canvas>
        
            <div class="message" style="opacity:0"></div>
            <div class="live_talk_input_body">
                <div class="live_talk_input_name_body">
                    <input name="name" type="text" class="live_talk_name white_input" id="AIuserName" autocomplete="off"
                           placeholder="ä½ çš„åå­—"/>
                </div>
                <div class="live_talk_input_text_body">
                    <input name="talk" type="text" class="live_talk_talk white_input" id="AIuserText" autocomplete="off"
                           placeholder="è¦å’Œæˆ‘èŠä»€ä¹ˆå‘€ï¼Ÿ"/>
                    <button type="button" class="live_talk_send_btn" id="talk_send">å‘é€</button>
                </div>
            </div>
            <input name="live_talk" id="live_talk" value="1" type="hidden"/>
            <div class="live_ico_box">
                <div class="live_ico_item type_info" id="showInfoBtn"></div>
                <div class="live_ico_item type_talk" id="showTalkBtn"></div>
                
                    <div class="live_ico_item type_music" id="musicButton"></div>
                
                <div class="live_ico_item type_quit" id="hideButton"></div>
                <input name="live_statu_val" id="live_statu_val" value="0" type="hidden"/>
                <audio src="" style="display:none;" id="live2d_bgm" data-bgm="0" preload="none"></audio>
                <input id="duType" value="douqilai" type="hidden">
                
                    <input name="live2dBGM" value="http://link.jscdn.cn/1drv/aHR0cHM6Ly8xZHJ2Lm1zL3UvcyFBa3NzTDBNMGNJNzdnUWFPSFdyRTBSaGFYOUg4P2U9YkxPdEY4.flac" type="hidden">
                
            </div>
        
    </div>
</div>
<div id="open_live2d">åˆ»åˆ»å¸ !!!</div>
<script>
    var message_Path = 'https://live2d.yhzdys.com/';
    let landlord = document.querySelector('#landlord');
    var apiKey = landlord.dataset.key;
</script>
<script type="text/javascript" src="/media/live2d/js/live2d.js"></script>
<script>
    var homePath = document.location.protocol + '//' + window.document.location.hostname + ":" + window.document.location.port + '/';
    var userAgent = window.navigator.userAgent.toLowerCase();
    var norunAI = ["android", "iphone", "ipod", "ipad", "windows phone", "mqqbrowser", "msie", "trident/7.0"];
    var norunFlag = false;

    for (var i = 0; i < norunAI.length; i++) {
        if (userAgent.indexOf(norunAI[i]) > -1) {
            norunFlag = true;
            break;
        }
    }

    if (!window.WebGLRenderingContext) {
        norunFlag = true;
    }

    if (!norunFlag) {
        var hitFlag = false;
        var AIFadeFlag = false;
        var liveTlakTimer = null;
        var sleepTimer_ = null;
        var AITalkFlag = false;
        var talkNum = 0;
        (function () {
            function renderTip(template, context) {
                var tokenReg = /(\\)?\{([^\{\}\\]+)(\\)?\}/g;
                return template.replace(tokenReg, function (word, slash1, token, slash2) {
                    if (slash1 || slash2) {
                        return word.replace('\\', '');
                    }
                    var variables = token.replace(/\s/g, '').split('.');
                    var currentObject = context;
                    var i, length, variable;
                    for (i = 0, length = variables.length; i < length; ++i) {
                        variable = variables[i];
                        currentObject = currentObject[variable];
                        if (currentObject === undefined || currentObject === null) return '';
                    }
                    return currentObject;
                });
            }

            String.prototype.renderTip = function (context) {
                return renderTip(this, context);
            };

            var re = /x/;
            re.toString = function () {
                showMessage('å“ˆå“ˆï¼Œä½ æ‰“å¼€äº†æ§åˆ¶å°ï¼Œæ˜¯æƒ³è¦çœ‹çœ‹æˆ‘çš„ç§˜å¯†å—ï¼Ÿ', 5000);
                return '';
            };

            $(document).on('copy', function () {
                showMessage('ä½ éƒ½å¤åˆ¶äº†äº›ä»€ä¹ˆå‘€ï¼Œè½¬è½½è¦è®°å¾—åŠ ä¸Šå‡ºå¤„å“¦~~', 5000);
            });

            function initTips() {
                $.ajax({
                    cache: true,
                    url: message_Path + 'message.json',
                    dataType: "json",
                    success: function (result) {
                        $.each(result.mouseover, function (index, tips) {
                            $(tips.selector).mouseover(function () {
                                var text = tips.text;
                                if (Array.isArray(tips.text)) text = tips.text[Math.floor(Math.random() * tips.text.length + 1) - 1];
                                text = text.renderTip({text: $(this).text()});
                                showMessage(text, 3000);
                                talkValTimer();
                                clearInterval(liveTlakTimer);
                                liveTlakTimer = null;
                            });
                            $(tips.selector).mouseout(function () {
                                showHitokoto();
                                if (liveTlakTimer == null) {
                                    liveTlakTimer = window.setInterval(function () {
                                        showHitokoto();
                                    }, 15000);
                                }
                            });
                        });
                        $.each(result.click, function (index, tips) {
                            $(tips.selector).click(function () {
                                if (hitFlag) {
                                    return false
                                }
                                hitFlag = true;
                                setTimeout(function () {
                                    hitFlag = false;
                                }, 8000);
                                var text = tips.text;
                                if (Array.isArray(tips.text)) text = tips.text[Math.floor(Math.random() * tips.text.length + 1) - 1];
                                text = text.renderTip({text: $(this).text()});
                                showMessage(text, 3000);
                            });
                            clearInterval(liveTlakTimer);
                            liveTlakTimer = null;
                            liveTlakTimer = window.setInterval(function () {
                                showHitokoto();
                            }, 15000);
                        });
                    }
                });
            }

            initTips();

            var text;
            if (document.referrer !== '') {
                var referrer = document.createElement('a');
                referrer.href = document.referrer;
                text = 'å—¨ï¼æ¥è‡ª <span style="color:#0099cc;">' + referrer.hostname + '</span> çš„æœ‹å‹ï¼';
                var domain = referrer.hostname.split('.')[1];
                if (domain == 'baidu') {
                    text = 'å—¨ï¼ æ¥è‡ª ç™¾åº¦æœç´¢ çš„æœ‹å‹ï¼<br>æ¬¢è¿è®¿é—®<span style="color:#0099cc;">ã€Œ ' + document.title.split(' - ')[0] + ' ã€</span>';
                } else if (domain == 'bing') {
                    text = 'å—¨ï¼ æ¥è‡ª å¿…åº”æœç´¢ çš„æœ‹å‹ï¼<br>æ¬¢è¿è®¿é—®<span style="color:#0099cc;">ã€Œ ' + document.title.split(' - ')[0] + ' ã€</span>';
                } else if (domain == 'so') {
                    text = 'å—¨ï¼ æ¥è‡ª 360æœç´¢ çš„æœ‹å‹ï¼<br>æ¬¢è¿è®¿é—®<span style="color:#0099cc;">ã€Œ ' + document.title.split(' - ')[0] + ' ã€</span>';
                } else if (domain == 'google') {
                    text = 'å—¨ï¼ æ¥è‡ª è°·æ­Œæœç´¢ çš„æœ‹å‹ï¼<br>æ¬¢è¿è®¿é—®<span style="color:#0099cc;">ã€Œ ' + document.title.split(' - ')[0] + ' ã€</span>';
                }
            } else {
                // ä¸»é¡µURLåˆ¤æ–­ï¼Œéœ€è¦æ–œæ ç»“å°¾
                if (window.location.href == homePath) {
                    var now = (new Date()).getHours();
                    if (now > 23 || now <= 5) {
                        text = 'ä½ æ˜¯å¤œçŒ«å­å‘€ï¼Ÿè¿™ä¹ˆæ™šè¿˜ä¸ç¡è§‰ï¼Œæ˜å¤©èµ·çš„æ¥å˜›ï¼Ÿ';
                    } else if (now > 5 && now <= 7) {
                        text = 'æ—©ä¸Šå¥½ï¼ä¸€æ—¥ä¹‹è®¡åœ¨äºæ™¨ï¼Œç¾å¥½çš„ä¸€å¤©å°±è¦å¼€å§‹äº†ï¼';
                    } else if (now > 7 && now <= 11) {
                        text = 'ä¸Šåˆå¥½ï¼å·¥ä½œé¡ºåˆ©å˜›ï¼Œä¸è¦ä¹…åï¼Œå¤šèµ·æ¥èµ°åŠ¨èµ°åŠ¨å“¦ï¼';
                    } else if (now > 11 && now <= 14) {
                        text = 'ä¸­åˆäº†ï¼Œå·¥ä½œäº†ä¸€ä¸ªä¸Šåˆï¼Œç°åœ¨æ˜¯åˆé¤æ—¶é—´ï¼';
                    } else if (now > 14 && now <= 17) {
                        text = 'åˆåå¾ˆå®¹æ˜“çŠ¯å›°å‘¢ï¼Œä»Šå¤©çš„è¿åŠ¨ç›®æ ‡å®Œæˆäº†å—ï¼Ÿ';
                    } else if (now > 17 && now <= 19) {
                        text = 'å‚æ™šäº†ï¼çª—å¤–å¤•é˜³çš„æ™¯è‰²å¾ˆç¾ä¸½å‘¢ï¼Œæœ€ç¾ä¸è¿‡å¤•é˜³çº¢~~';
                    } else if (now > 19 && now <= 21) {
                        text = 'æ™šä¸Šå¥½ï¼Œä»Šå¤©è¿‡å¾—æ€ä¹ˆæ ·ï¼Ÿ';
                    } else if (now > 21 && now <= 23) {
                        text = 'å·²ç»è¿™ä¹ˆæ™šäº†å‘€ï¼Œæ—©ç‚¹ä¼‘æ¯å§ï¼Œæ™šå®‰~~';
                    } else {
                        text = 'å—¨~ å¿«æ¥é€—æˆ‘ç©å§ï¼';
                    }
                } else {
                    text = 'æ¬¢è¿é˜…è¯»<span style="color:#0099cc;">ã€Œ ' + document.title.split(' - ')[0] + ' ã€</span>';
                }
            }
            showMessage(text, 12000);
        })();

        liveTlakTimer = setInterval(function () {
            showHitokoto();
        }, 15000);

        function showHitokoto() {
            if (sessionStorage.getItem("Sleepy") !== "1") {
                if (!AITalkFlag) {
                    $.getJSON('https://v1.hitokoto.cn/?c=a', function (result) {
                        talkValTimer();
                        showMessage(result.hitokoto, 0);
                    });
                }
            } else {
                hideMessage(0);
                if (sleepTimer_ == null) {
                    sleepTimer_ = setInterval(function () {
                        checkSleep();
                    }, 200);
                }
            }
        }

        function checkSleep() {
            var sleepStatu = sessionStorage.getItem("Sleepy");
            if (sleepStatu !== '1') {
                talkValTimer();
                showMessage('ä½ å›æ¥å•¦~', 0);
                clearInterval(sleepTimer_);
                sleepTimer_ = null;
            }
        }

        function showMessage(text, timeout) {
            if (Array.isArray(text)) text = text[Math.floor(Math.random() * text.length + 1) - 1];
            $('.message').stop();
            $('.message').html(text);
            $('.message').fadeTo(200, 1);
            // if (timeout === null) timeout = 5000;
            // hideMessage(timeout);
        }

        function talkValTimer() {
            $('#live_talk').val('1');
        }

        function hideMessage(timeout) {
            // $('.message').stop().css('opacity',1);
            if (timeout === null) timeout = 5000;
            $('.message').delay(timeout).fadeTo(200, 0);
        }

        function initLive2d() {
            $('#hideButton').on('click', function () {
                if (AIFadeFlag) {
                    return false;
                } else {
                    AIFadeFlag = true;
                    localStorage.setItem("live2dhidden", "0");
                    $('#landlord').fadeOut(200);
                    $('#open_live2d').delay(200).fadeIn(200);
                    setTimeout(function () {
                        AIFadeFlag = false;
                    }, 300);
                }
            });
            $('#open_live2d').on('click', function () {
                if (AIFadeFlag) {
                    return false;
                } else {
                    AIFadeFlag = true;
                    localStorage.setItem("live2dhidden", "1");
                    $('#open_live2d').fadeOut(200);
                    $('#landlord').delay(200).fadeIn(200);
                    setTimeout(function () {
                        AIFadeFlag = false;
                    }, 300);
                }
            });
            if (apiKey) {
                $('#showInfoBtn').on('click', function () {
                    var live_statu = $('#live_statu_val').val();
                    if (live_statu == "0") {
                        return
                    } else {
                        $('#live_statu_val').val("0");
                        $('.live_talk_input_body').fadeOut(500);
                        AITalkFlag = false;
                        showHitokoto();
                        $('#showTalkBtn').show();
                        $('#showInfoBtn').hide();
                    }
                });
                $('#showTalkBtn').on('click', function () {
                    var live_statu = $('#live_statu_val').val();
                    if (live_statu == "1") {
                        return
                    } else {
                        $('#live_statu_val').val("1");
                        $('.live_talk_input_body').fadeIn(500);
                        AITalkFlag = true;
                        $('#showTalkBtn').hide();
                        $('#showInfoBtn').show();

                    }
                });
                $('#talk_send').on('click', function () {
                    var info_ = $('#AIuserText').val();
                    var userid_ = $('#AIuserName').val();
                    if (info_ == "") {
                        showMessage('å†™ç‚¹ä»€ä¹ˆå§ï¼', 0);
                        return;
                    }
                    if (userid_ == "") {
                        showMessage('èŠä¹‹å‰è¯·å‘Šè¯‰æˆ‘ä½ çš„åå­—å§ï¼', 0);
                        return;
                    }
                    showMessage('æ€è€ƒä¸­~', 0);
                    let protocol = window.location.protocol.indexOf("s") > 0 ? "https" : "http";
                    $.ajax({
                        type: "get",
                        url: `${protocol}://www.tuling123.com/openapi/api?key=${apiKey}&info=${info_}`,
                        dataType: "json",
                        success: function (res) {
                            talkValTimer();
                            showMessage(res.text, 0);
                            $('#AIuserText').val("");
                            sessionStorage.setItem("live2duser", userid_);
                        },
                        error: function (e) {
                            talkValTimer();
                            showMessage('ä¼¼ä¹æœ‰ä»€ä¹ˆé”™è¯¯ï¼Œè¯·å’Œç«™é•¿è”ç³»ï¼', 0);
                        }
                    });
                });
            } else {
                $('#showInfoBtn').hide();
                $('#showTalkBtn').hide();
            }
            // è·å–éŸ³ä¹ä¿¡æ¯åˆå§‹åŒ–
            var bgmListInfo = $('input[name=live2dBGM]');
            if (bgmListInfo.length == 0) {
                $('#musicButton').hide();
            } else {
                var bgmPlayNow = parseInt($('#live2d_bgm').attr('data-bgm'));
                var bgmPlayTime = 0;
                var live2dBGM_Num = sessionStorage.getItem("live2dBGM_Num");
                var live2dBGM_PlayTime = sessionStorage.getItem("live2dBGM_PlayTime");
                if (live2dBGM_Num) {
                    if (live2dBGM_Num <= $('input[name=live2dBGM]').length - 1) {
                        bgmPlayNow = parseInt(live2dBGM_Num);
                    }
                }
                if (live2dBGM_PlayTime) {
                    bgmPlayTime = parseInt(live2dBGM_PlayTime);
                }
                var live2dBGMSrc = bgmListInfo.eq(bgmPlayNow).val();
                $('#live2d_bgm').attr('data-bgm', bgmPlayNow);
                $('#live2d_bgm').attr('src', live2dBGMSrc);
                $('#live2d_bgm')[0].currentTime = bgmPlayTime;
                $('#live2d_bgm')[0].volume = 0.5;
                var live2dBGM_IsPlay = sessionStorage.getItem("live2dBGM_IsPlay");
                var live2dBGM_WindowClose = sessionStorage.getItem("live2dBGM_WindowClose");
                if (live2dBGM_IsPlay == '0' && live2dBGM_WindowClose == '0') {
                    $('#live2d_bgm')[0].play();
                    $('#musicButton').addClass('play');
                }
                sessionStorage.setItem("live2dBGM_WindowClose", '1');
                $('#musicButton').on('click', function () {
                    if ($('#musicButton').hasClass('play')) {
                        $('#live2d_bgm')[0].pause();
                        $('#musicButton').removeClass('play');
                        sessionStorage.setItem("live2dBGM_IsPlay", '1');
                    } else {
                        $('#live2d_bgm')[0].play();
                        $('#musicButton').addClass('play');
                        sessionStorage.setItem("live2dBGM_IsPlay", '0');
                    }
                });
                window.onbeforeunload = function () {
                    sessionStorage.setItem("live2dBGM_WindowClose", '0');
                    if ($('#musicButton').hasClass('play')) {
                        sessionStorage.setItem("live2dBGM_IsPlay", '0');
                    }
                }
                document.getElementById('live2d_bgm').addEventListener("timeupdate", function () {
                    var live2dBgmPlayTimeNow = document.getElementById('live2d_bgm').currentTime;
                    sessionStorage.setItem("live2dBGM_PlayTime", live2dBgmPlayTimeNow);
                });
                document.getElementById('live2d_bgm').addEventListener("ended", function () {
                    var listNow = parseInt($('#live2d_bgm').attr('data-bgm'));
                    listNow++;
                    if (listNow > $('input[name=live2dBGM]').length - 1) {
                        listNow = 0;
                    }
                    var listNewSrc = $('input[name=live2dBGM]').eq(listNow).val();
                    sessionStorage.setItem("live2dBGM_Num", listNow);
                    $('#live2d_bgm').attr('src', listNewSrc);
                    $('#live2d_bgm')[0].play();
                    $('#live2d_bgm').attr('data-bgm', listNow);
                });
                document.getElementById('live2d_bgm').addEventListener("error", function () {
                    $('#live2d_bgm')[0].pause();
                    $('#musicButton').removeClass('play');
                    showMessage('éŸ³ä¹ä¼¼ä¹åŠ è½½ä¸å‡ºæ¥äº†å‘¢ï¼', 0);
                });
            }
            // è·å–ç”¨æˆ·å
            var live2dUser = sessionStorage.getItem("live2duser");
            if (live2dUser !== null) {
                $('#AIuserName').val(live2dUser);
            }
            // è·å–ä½ç½®
            var landL = sessionStorage.getItem("historywidth");
            var landB = sessionStorage.getItem("historyheight");
            if (landL == null || landB == null) {
                landL = '5px'
                landB = '0px'
            }
            $('#landlord').css('left', landL + 'px');
            $('#landlord').css('bottom', landB + 'px');

            // ç§»åŠ¨
            function getEvent() {
                return window.event || arguments.callee.caller.arguments[0];
            }

            var smcc = document.getElementById("landlord");
            var moveX = 0;
            var moveY = 0;
            var moveBottom = 0;
            var moveLeft = 0;
            var moveable = false;
            var docMouseMoveEvent = document.onmousemove;
            var docMouseUpEvent = document.onmouseup;
            smcc.onmousedown = function () {
                var ent = getEvent();
                moveable = true;
                moveX = ent.clientX;
                moveY = ent.clientY;
                var obj = smcc;
                moveBottom = parseInt(obj.style.bottom);
                moveLeft = parseInt(obj.style.left);
                if (isFirefox = navigator.userAgent.indexOf("Firefox") > 0) {
                    window.getSelection().removeAllRanges();
                }
                document.onmousemove = function () {
                    if (moveable) {
                        var ent = getEvent();
                        var x = moveLeft + ent.clientX - moveX;
                        var y = moveBottom + (moveY - ent.clientY);
                        obj.style.left = x + "px";
                        obj.style.bottom = y + "px";
                    }
                };
                document.onmouseup = function () {
                    if (moveable) {
                        var historywidth = obj.style.left;
                        var historyheight = obj.style.bottom;
                        historywidth = historywidth.replace('px', '');
                        historyheight = historyheight.replace('px', '');
                        sessionStorage.setItem("historywidth", historywidth);
                        sessionStorage.setItem("historyheight", historyheight);
                        document.onmousemove = docMouseMoveEvent;
                        document.onmouseup = docMouseUpEvent;
                        moveable = false;
                        moveX = 0;
                        moveY = 0;
                        moveBottom = 0;
                        moveLeft = 0;
                    }
                };
            };
        }

        $(document).ready(function () {
            var AIimgSrc = [];
            let chooseLive2d = 'kurumi'
            if (chooseLive2d === 'kurumi') {
                AIimgSrc.push(message_Path + "models/kurumi/textures/t1.png");
                AIimgSrc.push(message_Path + "models/kurumi/textures/t2.png");
                AIimgSrc.push(message_Path + "models/kurumi/textures/t3.png");
            }
            var images = [];
            var imgLength = AIimgSrc.length;
            var loadingNum = 0;
            for (var i = 0; i < imgLength; i++) {
                images[i] = new Image();
                images[i].src = AIimgSrc[i];
                images[i].onload = function () {
                    loadingNum++;
                    if (loadingNum === imgLength) {
                        var live2dhidden = localStorage.getItem("live2dhidden");
                        if (live2dhidden === "0") {
                            setTimeout(function () {
                                $('#open_live2d').fadeIn(200);
                            }, 1300);
                        } else {
                            setTimeout(function () {
                                $('#landlord').fadeIn(200);
                            }, 1300);
                        }
                        let model = '';
                        if (chooseLive2d === 'kurumi') {
                            model = message_Path + "models/kurumi/model.json";
                        }
                        setTimeout(function () {
                            loadlive2d("live2d", model);
                        }, 1000);
                        initLive2d();
                        images = null;
                    }
                }
            }
        });
    }
</script>
    
    
</div>
<script>
    let sideBarOpen = "sidebar-open";
    let body = document.body;
    let back2Top = document.querySelector("#back_to_top"),
        back2TopText = document.querySelector("#back_to_top_text"),
        drawerBox = document.querySelector("#drawer_box"),
        rightSideBar = document.querySelector(".sidebar"),
        viewport = document.querySelector("body");

    function scrollAnimation(currentY, targetY) {
        let needScrollTop = targetY - currentY;
        let _currentY = currentY;
        setTimeout(() => {
            const dist = Math.ceil(needScrollTop / 10);
            _currentY += dist;
            window.scrollTo(_currentY, currentY);
            if (needScrollTop > 10 || needScrollTop < -10) {
                scrollAnimation(_currentY, targetY);
            } else {
                window.scrollTo(_currentY, targetY);
            }
        }, 1);
    }

    back2Top.addEventListener("click", function (e) {
        scrollAnimation(document.scrollingElement.scrollTop, 0);
        e.stopPropagation();
        return false;
    });

    window.addEventListener("scroll", function (e) {
        let percent =
            (document.scrollingElement.scrollTop /
                (document.scrollingElement.scrollHeight -
                    document.scrollingElement.clientHeight)) *
            100;
        if (percent > 1 && !back2Top.classList.contains("back-top-active")) {
            back2Top.classList.add("back-top-active");
        }
        if (percent == 0) {
            back2Top.classList.remove("back-top-active");
        }
        if (back2TopText) {
            back2TopText.textContent = Math.floor(percent);
        }
    });

    let hasCacu = false;
    window.addEventListener("resize", function (e) {
        calcHeight();
    });

    function calcHeight() {
        // åŠ¨æ€è°ƒæ•´ç«™ç‚¹æ¦‚è§ˆé«˜åº¦
        if ((!hasCacu && back2Top.classList.contains("pisces")) || back2Top.classList.contains("gemini")) {
            let sideBar = document.querySelector(".sidebar");
            let navUl = document.querySelector("#site_nav");
            sideBar.style = "margin-top:" + (navUl.offsetHeight + navUl.offsetTop + 15) + "px;";
            hasCacu = true;
        }
    }
    calcHeight();
    let open = false,
        MOTION_TIME = 300,
        RIGHT_MOVE_DIS = "320px";

    if (drawerBox) {
        let rightMotions = document.querySelectorAll(".right-motion");
        let right = drawerBox.classList.contains("right");
        let transitionDir = right ? "transition.slideRightIn" : "transition.slideLeftIn";
        let openProp, closeProp;
        if (right) {
            openProp = {
                paddingRight: RIGHT_MOVE_DIS,
            };
            closeProp = {
                paddingRight: "0px",
            };
        } else {
            openProp = {
                paddingLeft: RIGHT_MOVE_DIS,
            };
            closeProp = {
                paddingLeft: "0px",
            };
        }

        drawerBox.onclick = function () {
            open = !open;
            jQuery.Velocity(rightSideBar, "stop");
            jQuery.Velocity(viewport, "stop");
            jQuery.Velocity(rightMotions, "stop");
            if (open) {
                jQuery.Velocity(
                    rightSideBar,
                    {
                        width: RIGHT_MOVE_DIS,
                    },
                    {
                        duration: MOTION_TIME,
                        begin: function () {
                            jQuery.Velocity(rightMotions, transitionDir, {});
                        },
                    }
                );
                jQuery.Velocity(viewport, openProp, {
                    duration: MOTION_TIME,
                });
            } else {
                jQuery.Velocity(
                    rightSideBar,
                    {
                        width: "0px",
                    },
                    {
                        duration: MOTION_TIME,
                        begin: function () {
                            jQuery.Velocity(rightMotions, {
                                opacity: 0,
                            });
                        },
                    }
                );
                jQuery.Velocity(viewport, closeProp, {
                    duration: MOTION_TIME,
                });
            }
            for (let i = 0; i < drawerBox.children.length; i++) {
                drawerBox.children[i].classList.toggle("muse-line");
            }
            drawerBox.classList.toggle(sideBarOpen);
        };
    }

    // é“¾æ¥è·³è½¬
    let newWindow = "false";
    if (newWindow === "true") {
        let links = document.querySelectorAll(".post-body a");
        links.forEach((item) => {
            if (!item.classList.contains("btn")) {
                item.setAttribute("target", "_blank");
            }
        });
    }

    let faSearch = document.querySelector("#fa_search");
    faSearch &&
    faSearch.addEventListener("click", function () {
        document.querySelector("#search_mask").style = "";
    });

    // ä»£ç é«˜äº®
    hljs.highlightAll();

    // ç¦»å¼€å½“å‰é¡µtitleå˜åŒ–
    var leaveTitle = "_(Ë‡Ï‰Ë‡ã€âˆ )_";
    var normal_title = document.title;
    if (leaveTitle) {
        document.addEventListener("visibilitychange", function () {
            if (document.visibilityState == "hidden") {
                normal_title = document.title;
                document.title = leaveTitle;
            } else {
                document.title = normal_title;
            }
        });
    }
</script>

<link rel="stylesheet" href="/media/css/jquery.fancybox.css"/>
<script src="/media/js/jquery.fancybox.js"></script>

<script>
    let images = document.querySelectorAll(".section img");
    images.forEach((image) => {
        var parent = image.parentElement;
        var next = image.nextElementSibling;
        parent.removeChild(image);
        var aelem = document.createElement("a");
        aelem.href = image.src;
        aelem.dataset["fancybox"] = "images";
        aelem.dataset["rel"] = "fancybox-button";
        aelem.classList.add("fancybox");
        aelem.appendChild(image);
        parent.insertBefore(aelem, next);
    });
</script>
    <div class="reward-mask" style="display: none;">
    <div class="reward-relative">
        <span class="close" aria-hidden="true">x</span>
        <div class="reward-body">
            <h2>æ„Ÿè°¢æ‚¨çš„æ”¯æŒï¼Œæˆ‘ä¼šç»§ç»­åŠªåŠ›çš„!</h2>
            <div class="reward-img-box">
                <div style="position: relative; width: 140px; height: 140px;">
                    
                    
                    
                </div>
            </div>
            <p class="reward-word">æ‰«ç æ‰“èµï¼Œä½ è¯´å¤šå°‘å°±å¤šå°‘</p>
            <p class="reward-tip"></p>
        </div>
        <div class="bottom">
            
            
        </div>
    </div>
</div>
<style>
    .reward-mask {
        position: fixed;
        z-index: 99999;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        background-color: #00000054;
    }

    .reward-relative {
        position: relative;
        width: 480px;
        text-align: center;
        margin: 0 auto;
        border-radius: 5px;
        background-color: #fff;
        top: 50%;
        margin-top: -205px;
    }

    .reward-relative .close {
        position: absolute;
        right: 10px;
        font-weight: normal;
        font-size: 16px;
        color: #929292;
    }

    .reward-body {
        padding: 40px 20px 20px;
    }

    .bottom {
        display: flex;
    }

    .reward-btn {
        text-align: center;
    }

    .reward-btn-text {
        display: inline-block;
        cursor: pointer;
        width: 60px;
        height: 60px;
        line-height: 60px;
        border-radius: 50%;
        background-color: #ff9734;
        color: #FFF;
        margin-top: 20px;
    }

    .pay-text {
        margin-top: 10px;
        padding: 10px;
        flex: 1;
        transition: all .2s linear;
    }

    .pay-text:hover {
        background-color: #a5a5a536;
    }

    .reward-body h2 {
        padding-top: 10px;
        text-align: center;
        color: #a3a3a3;
        font-size: 16px;
        font-weight: normal;
        margin: 0 0 20px;
    }

    .reward-body h2:after,
    .reward-body h2:before {
        font-family: Arial, Helvetica, sans-serif;
        background: 0 0;
        width: 0;
        height: 0;
        font-style: normal;
        color: #eee;
        font-size: 80px;
        position: absolute;
        top: 20px;
    }

    .reward-body h2:before {
        content: '\201c';
        left: 50px;
    }

    .reward-body h2:after {
        content: '\201d';
        right: 80px;
    }

    .reward-img-box {
        display: inline-block;
        padding: 10px;
        border: 6px solid #ea5f00;
        margin: 0 auto;
        border-radius: 3px;
        position: relative;
    }

    .reward-img {
        position: absolute;
        left: 0px;
        top: 0px;
        width: 100%;
        height: 100%;
    }

    @media (max-width: 767px) {
        .reward-relative {
            height: 100%;
            top: 0px;
            margin-top: 0;
            width: auto;
        }

        .reward-relative .bottom {
            flex-direction: column;
        }

        .reward-relative .pay-text {
            width: 80%;
            margin: 5px auto;
            border: 1px solid silver;
            padding: 6px;
            border-radius: 4px;
        }

        .reward-body h2:after {
            right: 40px;
        }

        .reward-body h2:after,
        .reward-body h2:before {
            font-size: 60px;
        }

        .reward-body h2:before {
            left: 20px;
        }
    }
</style>
<script>
    !function () {
        var mask = document.querySelector('.reward-mask');
        let close = document.querySelector('.reward-relative .close');
        let rewardBtn = document.querySelector('.reward-btn');

        let zfb = document.querySelector('#zfb'),
            wx = document.querySelector('#wx'),
            zfbBtn = document.querySelector('#zfbBtn'),
            wxBtn = document.querySelector('#wxBtn');

        if (zfbBtn && wxBtn) {
            zfbBtn.addEventListener('click', () => {
                jQuery.Velocity(zfb, 'transition.slideLeftIn', {
                    duration: 400
                });
                jQuery.Velocity(wx, 'transition.slideRightOut', {
                    display: 'none',
                    duration: 400
                });
            });

            wxBtn.addEventListener('click', () => {
                jQuery.Velocity(wx, 'transition.slideRightIn', {
                    duration: 400
                });
                jQuery.Velocity(zfb, 'transition.slideLeftOut', {
                    display: 'none',
                    duration: 400
                });
            });
        }

        if (rewardBtn) {
            rewardBtn.addEventListener('click', () => {
                jQuery.Velocity(mask, 'transition.slideDownIn', {
                    duration: 400
                })
            });
        }

        close.addEventListener('click', (e) => {
            e.preventDefault();
            jQuery.Velocity(mask, 'transition.slideUpOut', {
                duration: 400
            })
        })
    }()
</script>

</div>
</body>

    <div class="search-mask" id="search_mask" style="display: none;">
    <div class="search-box">
        <div class="search-title">
            <i class="fa fa-search"></i>
            <div class="input-box">
                <input id="search" type="text" class="language" data-lan="search" placeholder="æœç´¢">
            </div>
            <i id="close" class="fa fa-times-circle"></i>
        </div>
        <div class="stat-box">
            <span id="stat_count">0</span>
            <span class="language" data-lan="stat">æ¡ç›¸å…³æ¡ç›®ï¼Œä½¿ç”¨äº†</span>
            <span id="stat_times">0</span>
            <span class="language" data-lan="stat-time">æ¯«ç§’</span>
            <hr>
        </div>
        <div class="result" id="result">
            
                <div class="item">
                    <a class="result-title" style="opacity: 0;" href="https://blog.yhzdys.com/post/220508133607/"" data-c="
                    &lt;blockquote&gt;
&lt;p&gt;ç»™ä¸Šä¸€ç¯‡åšæ–‡å¡«ä¸ªå‘ï¼Œè®²è§£ä¸‹è´Ÿè½½å‡è¡¡ç®—æ³•ä¸­æœ€å¸¸è§çš„åŠ æƒéšæœºç®—æ³•&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!-- more --&gt;
&lt;h2 id=&#34;åŠ æƒéšæœºç®—æ³•&#34;&gt;åŠ æƒéšæœºç®—æ³•&lt;/h2&gt;
&lt;p&gt;è´Ÿè½½å‡è¡¡çš„ä¸€ç§ç®—æ³•å®ç°ï¼Œæ•ˆæœæ˜¯æŒ‰æœåŠ¡çš„æƒé‡è®¾ç½®ï¼Œéé¡ºåºåœ°è¯·æ±‚èµ„æºæœåŠ¡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æºç åˆ†æ&#34;&gt;æºç åˆ†æ&lt;/h2&gt;
&lt;p&gt;Dubboçš„è´Ÿè½½å‡è¡¡ç®—æ³•å®ç°ï¼Œæ”¾åœ¨org.apache.dubbo.rpc.clusteråŒ…ä¸‹ï¼Œä»¥org.apache.dubbo.rpc.cluster.LoadBalanceå®šä¹‰ï¼Œé€šè¿‡SPIåŠŸèƒ½åŠ¨æ€åŠ è½½ï¼Œé»˜è®¤å®ç°ä¸ºorg.apache.dubbo.rpc.cluster.loadbalance.RandomLoadBalanceï¼ˆåŠ æƒéšæœºï¼‰&lt;/p&gt;
&lt;h3 id=&#34;æºç å®ç°&#34;&gt;æºç å®ç°&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;protected &amp;lt;T&amp;gt; Invoker&amp;lt;T&amp;gt; doSelect(List&amp;lt;Invoker&amp;lt;T&amp;gt;&amp;gt; invokers, URL url, Invocation invocation) {
        int length = invokers.size();
        // æ ‡è®°ä½ï¼Œæ ‡è¯†æ‰€æœ‰æœåŠ¡çš„æƒé‡æ˜¯å¦å…¨éƒ½ç›¸åŒ
        boolean sameWeight = true;
        // æ¯ä¸ªæœåŠ¡ä¸‹æ ‡å¯¹åº”çš„æƒé‡ï¼Œåœ¨xè½´åæ ‡ä¸Šçš„ä½ç½®
        // ä¾‹ï¼šABCä¸‰ä¸ªæœåŠ¡çš„æƒé‡ä¸º10ã€20ã€30ï¼Œä¸ºæ‰€æœ‰æœåŠ¡åˆ›å»ºä¸€ä¸ªä¸€ç»´åæ ‡ï¼Œåˆ™AæœåŠ¡è½åœ¨è·ç¦»åŸç‚¹ä¸º10çš„ä½ç½®ï¼ŒBè½åœ¨è·ç¦»åŸç‚¹30çš„ä½ç½®ï¼ŒCè½åœ¨è·ç¦»åŸç‚¹60çš„ä½ç½®
        int[] weights = new int[length];
        // æ‰€æœ‰æœåŠ¡é™æ€æƒé‡ä¹‹å’Œ
        int totalWeight = 0;
        for (int i = 0; i &amp;lt; length; i++) {
            int weight = getWeight(invokers.get(i), invocation);
            totalWeight += weight;
            // æœåŠ¡è·ç¦»åæ ‡ç³»åŸç‚¹çš„ä½ç½®
            weights[i] = totalWeight;
            if (sameWeight &amp;amp;&amp;amp; totalWeight != weight * (i + 1)) {
                sameWeight = false;
            }
        }
        // å½“æ‰€æœ‰æœåŠ¡çš„æƒé‡ä¸å…¨ç›¸ç­‰æ—¶ï¼Œè§¦å‘åŠ æƒéšæœº
        if (totalWeight &amp;gt; 0 &amp;amp;&amp;amp; !sameWeight) {
            // ä»¥0åˆ°æ‰€æœ‰æœåŠ¡æƒé‡ä¹‹å’Œä¸ºåŒºé—´å–éšæœºæ•°
            int offset = ThreadLocalRandom.current().nextInt(totalWeight);
            // å°†éšæœºæ•°æ”¾åœ¨ä¸Šè¿°å»ºç«‹çš„ä¸€ä½åæ ‡ä¸­ï¼Œå–åœ¨éšæœºæ•°è½ç‚¹å³è¾¹ä¸”æœ€è¿‘çš„ä¸€å°æœåŠ¡ä½œä¸ºé€‰ä¸¾ç»“æœ
            for (int i = 0; i &amp;lt; length; i++) {
                if (offset &amp;lt; weights[i]) {
                    return invokers.get(i);
                }
            }
        }
        // å½“æ‰€æœ‰æœåŠ¡çš„æƒé‡å…¨éƒ½ç›¸ç­‰æ—¶ï¼Œå®Œå…¨éšæœºè°ƒç”¨
        return invokers.get(ThreadLocalRandom.current().nextInt(length));
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;æºç åˆ†æ-2&#34;&gt;æºç åˆ†æ&lt;/h3&gt;
&lt;p&gt;é¦–å…ˆDubboä¼šè½®è®­æ‰€è°ƒç”¨èµ„æºæœåŠ¡çš„æ‰€æœ‰å®ä¾‹ï¼Œè®¡ç®—æ‰€æœ‰æœåŠ¡çš„é™æ€æƒé‡ä¹‹å’Œï¼ˆtotalWeightï¼‰ï¼Œä½¿ç”¨0åˆ°totalWeightå»ºç«‹ä¸€ä¸ªä¸€ä½åæ ‡ç³»ï¼Œå°†æ‰€æœ‰æœåŠ¡æŒ‰ç…§æƒé‡å€¼åˆ†é…åˆ°åæ ‡ç³»çš„æ¯ä¸ªèŠ‚ç‚¹&lt;/p&gt;
&lt;p&gt;ä¾‹ï¼šç›®å‰æœ‰Aã€Bã€Cä¸‰ä¸ªæœåŠ¡ï¼Œæƒé‡é…ç½®åˆ†åˆ«ä¸ºA=10ã€B=20ã€C=10&lt;/p&gt;
&lt;p&gt;åˆ™Aã€Bã€Cä¼šåˆ†åˆ«ä½äºè·ç¦»åæ ‡ç³»åŸç‚¹10ã€30ã€40çš„ä½ç½®ï¼Œå¦‚ä¸‹å›¾&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://image.yhzdys.com/RKaAgU.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;åœ¨æ‰€æœ‰æœåŠ¡çš„æƒé‡ä¹‹å’Œï¼ˆtotalWeightï¼‰èŒƒå›´å†…å»ºç«‹ä¸€ä¸ªä¸€ä½åæ ‡ç³»ï¼Œä»¥0ä¸ºä¸‹é™ä»¥totalWeightä¸ºä¸Šé™å–éšæœºæ•°ï¼Œå½“éšæœºæ•°è½ç‚¹åœ¨æœåŠ¡å„è‡ªçš„èŒƒå›´å†…æ—¶ï¼Œåˆ™å¯¹åº”çš„æœåŠ¡ä½œä¸ºé€‰ä¸¾ç»“æœ&lt;/p&gt;
&lt;h2 id=&#34;å®ä¾‹æ¼”ç¤º&#34;&gt;å®ä¾‹æ¼”ç¤º&lt;/h2&gt;
&lt;p&gt;æ²¡æœ‰ï¼Œè‡ªå·±è„‘è¡¥å§&lt;/p&gt;
">åŠ æƒéšæœºç®—æ³•</a>
                </div>
            
                <div class="item">
                    <a class="result-title" style="opacity: 0;" href="https://blog.yhzdys.com/post/220304224140/"" data-c="
                    &lt;blockquote&gt;
&lt;p&gt;å‰å‡ å¤©å‚åŠ æŸå…¬å¸é¢è¯•ï¼Œè¢«é—®åˆ°Dubboçš„è´Ÿè½½å‡è¡¡ç®—æ³•å®ç°ï¼Œç”±äºç”µè¯é¢è¯•æ— æ³•ç”»å›¾è¯¦è§£ï¼Œä¸æ‰å°ç”Ÿç®€å•å£å¤´æè¿°åï¼Œæ¢æ¥é¢è¯•å®˜ä¸€å¥â€œæ²¡è¿™ä¹ˆå¤æ‚å§â€ï¼ˆ...ï¼‰ã€‚äºæ˜¯å†™ä¸‹æ­¤ç¯‡æ–‡ç« ï¼Œè¯¦ç»†ä»‹ç»ä¸‹Dubboæ¡†æ¶ä¸­è´Ÿè½½å‡è¡¡çš„åŠ æƒè½®è®­ç®—æ³•å®ç°ã€‚åç»­å¦‚æœæœ‰é—²æƒ…çš„è¯ï¼Œå†å®Œå–„å…¶ä½™çš„ç®—æ³•å®ç°ï¼ˆå¤§æ¦‚ï¼‰&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!-- more --&gt;
&lt;h2 id=&#34;ç®€å•ä»‹ç»&#34;&gt;ç®€å•ä»‹ç»&lt;/h2&gt;
&lt;p&gt;è´Ÿè½½å‡è¡¡ï¼ˆLoadBalanceï¼‰çš„è¯¦ç»†å®šä¹‰è¯·å‚è€ƒ&lt;a href=&#34;https://en.wikipedia.org/wiki/Load_balancing_(computing)&#34;&gt;&lt;strong&gt;ç»´åŸºç™¾ç§‘&lt;/strong&gt;&lt;/a&gt;ä»¥åŠ&lt;a href=&#34;https://dubbo.apache.org/zh/docs/advanced/loadbalance/&#34;&gt;&lt;strong&gt;Dubboå®˜æ–¹æ–‡æ¡£&lt;/strong&gt;&lt;/a&gt;ï¼Œç®€å•æ¥è¯´å°±æ˜¯é’ˆå¯¹æœåŠ¡é›†ç¾¤ï¼ŒæŒ‰ç…§ç‰¹å®šçš„è§„åˆ™å¯¹è¯·æ±‚è¿›è¡Œåˆ†å‘ï¼Œä½¿é›†ç¾¤ä¸‹çš„èµ„æºè¢«å¹³è¡¡è®¿é—®çš„ä¸€ç§æŠ€æœ¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;åŠ æƒè½®è®­ç®—æ³•&#34;&gt;åŠ æƒè½®è®­ç®—æ³•&lt;/h2&gt;
&lt;p&gt;è´Ÿè½½å‡è¡¡çš„ä¸€ç§ç®—æ³•å®ç°ï¼Œæ•ˆæœæ˜¯æŒ‰æœåŠ¡çš„æƒé‡è®¾ç½®è½®è¯¢æ¯”ç‡ï¼Œå¾ªç¯è¯·æ±‚èµ„æºæœåŠ¡ã€‚Dubbo å€Ÿé‰´ Nginx çš„å¹³æ»‘åŠ æƒè½®è¯¢ç®—æ³•ï¼Œå¹¶å¯¹æ­¤åšäº†ä¼˜åŒ–ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æºç åˆ†æ&#34;&gt;æºç åˆ†æ&lt;/h2&gt;
&lt;p&gt;Dubboçš„è´Ÿè½½å‡è¡¡ç®—æ³•å®ç°ï¼Œæ”¾åœ¨org.apache.dubbo.rpc.clusteråŒ…ä¸‹ï¼Œä»¥org.apache.dubbo.rpc.cluster.LoadBalanceå®šä¹‰ï¼Œé€šè¿‡SPIåŠŸèƒ½åŠ¨æ€åŠ è½½ï¼Œé»˜è®¤å®ç°ä¸ºorg.apache.dubbo.rpc.cluster.loadbalance.RandomLoadBalanceï¼ˆåŠ æƒéšæœºï¼‰ï¼Œæœ¬æ–‡ç€é‡ä»‹ç»Dubboæ¡†æ¶ä¸‹çš„å¦ä¸€ç§è´Ÿè½½å‡è¡¡å®ç°-åŠ æƒè½®è®­ï¼Œæºç ä½ç½®org.apache.dubbo.rpc.cluster.loadbalance.RoundRobinLoadBalance#doSelect&lt;/p&gt;
&lt;h3 id=&#34;æºç å®ç°&#34;&gt;æºç å®ç°&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;protected &amp;lt;T&amp;gt; Invoker&amp;lt;T&amp;gt; doSelect(List&amp;lt;Invoker&amp;lt;T&amp;gt;&amp;gt; invokers, URL url, Invocation invocation) {
        String key = invokers.get(0).getUrl().getServiceKey() + &amp;quot;.&amp;quot; + invocation.getMethodName();
        ConcurrentMap&amp;lt;String, WeightedRoundRobin&amp;gt; map = methodWeightMap.computeIfAbsent(key, k -&amp;gt; new ConcurrentHashMap&amp;lt;&amp;gt;());
        // æ‰€æœ‰æœåŠ¡çš„é™æ€æƒé‡ä¹‹å’Œ
        int totalWeight = 0;
        long maxCurrent = Long.MIN_VALUE;
        long now = System.currentTimeMillis();
        Invoker&amp;lt;T&amp;gt; selectedInvoker = null;
        WeightedRoundRobin selectedWRR = null;
        for (Invoker&amp;lt;T&amp;gt; invoker : invokers) {
            String identifyString = invoker.getUrl().toIdentityString();
            // è·å–é…ç½®çš„é™æ€æƒé‡
            int weight = getWeight(invoker, invocation);
            // æœåŠ¡æƒé‡çš„äºŒæ¬¡åŒ…è£…
            WeightedRoundRobin weightedRoundRobin = map.computeIfAbsent(identifyString, k -&amp;gt; {
                WeightedRoundRobin wrr = new WeightedRoundRobin();
                wrr.setWeight(weight);
                return wrr;
            });

            if (weight != weightedRoundRobin.getWeight()) {
                weightedRoundRobin.setWeight(weight);
            }
            // å½“å‰åŠ¨æ€æƒé‡è‡ªå¢ï¼Œè‡ªå¢å€¼ä¸ºæœåŠ¡çš„é™æ€æƒé‡
            long cur = weightedRoundRobin.increaseCurrent();
            weightedRoundRobin.setLastUpdate(now);
            // é€‰å‡ºåŠ¨æ€æƒé‡æœ€å¤§çš„é‚£å°æœåŠ¡
            if (cur &amp;gt; maxCurrent) {
                maxCurrent = cur;
                selectedInvoker = invoker;
                selectedWRR = weightedRoundRobin;
            }
            totalWeight += weight;
        }
        if (invokers.size() != map.size()) {
            map.entrySet().removeIf(item -&amp;gt; now - item.getValue().getLastUpdate() &amp;gt; RECYCLE_PERIOD);
        }
        if (selectedInvoker != null) {
            // è¢«é€‰ä¸­æœåŠ¡çš„åŠ¨æ€æƒé‡ä¼šå‡å»æ‰€æœ‰æœåŠ¡çš„é™æ€æƒé‡ä¹‹å’Œ
            selectedWRR.sel(totalWeight);
            return selectedInvoker;
        }
        return invokers.get(0);
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;æºç åˆ†æ-2&#34;&gt;æºç åˆ†æ&lt;/h3&gt;
&lt;p&gt;é¦–å…ˆç®—æ³•ä¼šè½®è®­æ‰€è°ƒç”¨æœåŠ¡çš„æ‰€æœ‰å®ä¾‹ï¼Œè®¡ç®—æ‰€æœ‰æœåŠ¡çš„é™æ€æƒé‡ä¹‹å’Œï¼ˆtotalWeightï¼‰ï¼Œå¹¶å¯¹å„æœåŠ¡çš„æƒé‡ä½¿ç”¨å†…éƒ¨ç±»WeightedRoundRobinè¿›è¡Œçš„äºŒæ¬¡åŒ…è£…ï¼Œæºç å¦‚ä¸‹&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;protected static class WeightedRoundRobin {
        // æœåŠ¡é…ç½®çš„é™æ€æƒé‡
        private int weight;
        // åŠ¨æ€æƒé‡
        private AtomicLong current = new AtomicLong(0);
        private long lastUpdate;

        public int getWeight() {
            return weight;
        }

        public void setWeight(int weight) {
            this.weight = weight;
            // åˆå§‹åŒ–åŠ¨æ€æƒé‡ä¸º0
            current.set(0);
        }
        // æ“ä½œåŠ¨æ€æƒé‡ï¼Œè‡ªå¢é™æ€æƒé‡
        public long increaseCurrent() {
            return current.addAndGet(weight);
        }
        // æ“ä½œåŠ¨æ€æƒé‡ï¼Œå‡æ³•
        public void sel(int total) {
            current.addAndGet(-1 * total);
        }

        public long getLastUpdate() {
            return lastUpdate;
        }

        public void setLastUpdate(long lastUpdate) {
            this.lastUpdate = lastUpdate;
        }
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¯ä»¥å‘ç°åœ¨WeightedRoundRobinä¸­ä¸ºæ‰€æœ‰æœåŠ¡å®šä¹‰äº†ä¸€ä¸ªåŠ¨æ€çš„æƒé‡å€¼ï¼Œè¯¥å€¼åç»­ä¼šåœ¨æ¯æ¬¡æœåŠ¡è°ƒç”¨åæ”¹å˜ã€‚å¯ä»¥çœ‹åˆ°Dubboåœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨æœåŠ¡æ—¶ï¼Œé™¤äº†æœåŠ¡æœ¬èº«é…ç½®çš„é™æ€æƒé‡å¤–ï¼Œè¿˜ä¼šç»™æ‰€æœ‰æœåŠ¡åˆå§‹åŒ–ä¸€ä¸ªå€¼ä¸º0çš„åŠ¨æ€æƒé‡ã€‚åœ¨æ¯æ¬¡é€‰ä¸¾ä¹‹å‰ï¼Œå°†æ‰€æœ‰æœåŠ¡çš„åŠ¨æ€æƒé‡åŠ ä¸Šè‡ªèº«çš„é™æ€æƒé‡åï¼Œé€‰ä¸¾å‡ºåŠ¨æ€æƒé‡æœ€å¤§çš„æœåŠ¡è¿›è¡Œè°ƒç”¨ï¼Œé€‰ä¸¾å®Œæˆåå†å°†é€‰ä¸­æœåŠ¡çš„åŠ¨æ€æƒé‡å‡å»æ‰€æœ‰æœåŠ¡çš„é™æ€æƒé‡ä¹‹å’Œï¼ˆtotalWeightï¼‰ï¼Œç„¶åä»¥æ­¤ä¸ºå¾ªç¯ï¼Œå®ç°æœåŠ¡çš„åŠ æƒè½®è¯¢é€‰ä¸¾ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®ä¾‹æ¼”ç¤º&#34;&gt;å®ä¾‹æ¼”ç¤º&lt;/h2&gt;
&lt;p&gt;å‡è®¾ç›®å‰æˆ‘ä»¬æœ‰ABCä¸‰å°æœåŠ¡ï¼Œå…¶é…ç½®çš„æƒé‡åˆ†åˆ«ä¸ºA=2 B=1 C=1ï¼ˆè¿™é‡Œä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºï¼Œå®é™…æƒ…å†µä¸‹æƒé‡å€¼çš„é…ç½®å¾€å¾€ä¸ºç™¾ä½æ•°ï¼Œæ¥æé«˜ç²¾ç»†åº¦ï¼‰ï¼Œé‚£ä¹ˆåœ¨è¿›å…¥é€‰ä¸¾æ—¶ï¼Œä¼šåˆ†åˆ«ä¸ºè¿™ä¸‰å°æœåŠ¡åˆå§‹åŒ–å€¼ä¸º0çš„åŠ¨æ€æƒé‡ï¼Œåç»­æµç¨‹çœ‹ä¸‹è¡¨ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;è½®è®­æ¬¡æ•°&lt;/th&gt;
&lt;th&gt;é€‰ä¸¾å‰åŠ¨æ€æƒé‡ï¼ˆè‡ªå¢é™æ€æƒé‡ï¼‰&lt;/th&gt;
&lt;th&gt;é€‰ä¸¾ç»“æœ&lt;/th&gt;
&lt;th&gt;é€‰ä¸¾ååŠ¨æ€æƒé‡ï¼ˆå‡å»é™æ€æƒé‡ä¹‹å’Œï¼‰&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;A(2) B(1) C(1)&lt;/td&gt;
&lt;td&gt;A&lt;/td&gt;
&lt;td&gt;A(-2) B(1) C(1)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;A(0) B(2) C(2)&lt;/td&gt;
&lt;td&gt;B&lt;/td&gt;
&lt;td&gt;A(0) B(-2) C(2)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;A(2) B(-1) C(3)&lt;/td&gt;
&lt;td&gt;C&lt;/td&gt;
&lt;td&gt;A(2) B(-1) C(-1)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;A(4) B(0) C(0)&lt;/td&gt;
&lt;td&gt;A&lt;/td&gt;
&lt;td&gt;A(0) B(0) C(0)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;A(2) B(1) C(1)&lt;/td&gt;
&lt;td&gt;A&lt;/td&gt;
&lt;td&gt;A(-2) B(1) C(1)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;A(0) B(2) C(2)&lt;/td&gt;
&lt;td&gt;B&lt;/td&gt;
&lt;td&gt;A(0) B(-2) C(2)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;A(2) B(-1) C(3)&lt;/td&gt;
&lt;td&gt;C&lt;/td&gt;
&lt;td&gt;A(2) B(-1) C(-1)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;A(4) B(0) C(0)&lt;/td&gt;
&lt;td&gt;A&lt;/td&gt;
&lt;td&gt;A(0) B(0) C(0)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9&lt;/td&gt;
&lt;td&gt;A(2) B(1) C(1)&lt;/td&gt;
&lt;td&gt;A&lt;/td&gt;
&lt;td&gt;A(-2) B(1) C(1)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œé€‰ä¸¾ç»“æœä»¥Aã€Bã€Cã€Aä¸ºä¸€ç»„è¿›è¡Œå¾ªç¯ï¼Œç¬¦åˆä»¥A=2 B=1 C=1ä¸ºæƒé‡é…ç½®çš„æœŸæœ›ã€‚&lt;/p&gt;
">åŠ æƒè½®è¯¢ç®—æ³•</a>
                </div>
            
                <div class="item">
                    <a class="result-title" style="opacity: 0;" href="https://blog.yhzdys.com/post/211027212445/"" data-c="
                    &lt;blockquote&gt;
&lt;p&gt;SPI å…¨ç§°ä¸º Service Provider Interfaceï¼Œæ˜¯ä¸€ç§æœåŠ¡å‘ç°æœºåˆ¶ã€‚SPI çš„æœ¬è´¨æ˜¯å°†æ¥å£å®ç°ç±»çš„å…¨é™å®šåé…ç½®åœ¨æ–‡ä»¶ä¸­ï¼Œå¹¶ç”±æœåŠ¡åŠ è½½å™¨è¯»å–é…ç½®æ–‡ä»¶ï¼ŒåŠ è½½å®ç°ç±»ã€‚è¿™æ ·å¯ä»¥åœ¨è¿è¡Œæ—¶ï¼ŒåŠ¨æ€ä¸ºæ¥å£æ›¿æ¢å®ç°ç±»ã€‚æ­£å› æ­¤ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“çš„é€šè¿‡ SPI æœºåˆ¶ä¸ºæˆ‘ä»¬çš„ç¨‹åºæä¾›æ‹“å±•åŠŸèƒ½ã€‚SPI æœºåˆ¶åœ¨ç¬¬ä¸‰æ–¹æ¡†æ¶ä¸­ä¹Ÿæœ‰æ‰€åº”ç”¨ï¼Œæ¯”å¦‚ Dubbo å°±æ˜¯é€šè¿‡ SPI æœºåˆ¶åŠ è½½æ‰€æœ‰çš„ç»„ä»¶ã€‚ä¸è¿‡ï¼ŒDubbo å¹¶æœªä½¿ç”¨ java åŸç”Ÿçš„ SPI æœºåˆ¶ï¼Œè€Œæ˜¯å¯¹å…¶è¿›è¡Œäº†å¢å¼ºï¼Œä½¿å…¶èƒ½å¤Ÿæ›´å¥½çš„æ»¡è¶³éœ€æ±‚ã€‚åœ¨ Dubbo ä¸­ï¼ŒSPI æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ¨¡å—ã€‚åŸºäº SPIï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“çš„å¯¹ Dubbo è¿›è¡Œæ‹“å±•ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!-- more --&gt;
&lt;h2 id=&#34;dubbo-spiä»‹ç»&#34;&gt;Dubbo SPIä»‹ç»&lt;/h2&gt;
&lt;p&gt;Dubbo SPIå®ç°äº†è‡ªå·±çš„IOCå’ŒAOPæœºåˆ¶ï¼Œå…¶ä¸­æœåŠ¡çš„å®ä¾‹è¢«ç§°ä¸ºExtensionï¼ˆæ‰©å±•ï¼‰ï¼Œç±»ä¼¼äºSpringæ¡†æ¶ä¸­beançš„è§’è‰²ï¼Œæ˜¯ä¸€ä¸ªæ‰©å±•å®ç°ç±»çš„å®ä¾‹ã€‚Dubboæ¡†æ¶ä¸­æ‰€æœ‰ç±»çš„å®ä¾‹åŸºæœ¬éƒ½æ˜¯ä½¿ç”¨äº†SPIçš„æ–¹å¼è·å–ã€‚æ‰€ä»¥äº†è§£SPIçš„å®ç°æœºåˆ¶æ˜¯å­¦ä¹ Dubboçš„é‡ä¸­ä¹‹é‡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;dubbo-spiç¤ºä¾‹&#34;&gt;Dubbo SPIç¤ºä¾‹&lt;/h2&gt;
&lt;p&gt;è¿™é‡Œä»¥apache dubbo 2.xç‰ˆæœ¬ä¸ºä¾‹ï¼Œå¼•å…¥dubboä¾èµ–&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-XML&#34;&gt;&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.apache.dubbo&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;dubbo&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;2.7.15&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç¼–å†™æ‰©å±•ç±»çš„æ¥å£&lt;br&gt;
@SPIçš„valueä¸ºé»˜è®¤å®ç°ï¼Œ@Adpativeåˆ™ä¸ºè‡ªé€‚åº”åŠ è½½æ³¨è§£ï¼Œåœ¨ä»£ç è¿è¡Œæ—¶æ ¹æ®ä¼ å…¥çš„URLï¼ˆå¿…ä¼ ï¼‰å‚æ•°åŠ¨æ€åŠ è½½ï¼Œè¿™ä¸ªåé¢ä¼šè¯¦ç»†è®²è§£&lt;/p&gt;
&lt;p&gt;æ³¨ï¼šURL.classä¸ºDubboè‡ªå®šä¹‰ï¼Œå…¨é™åï¼šorg.apache.dubbo.common.URL&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@SPI(&amp;quot;apple&amp;quot;)
public interface Fruit {

    void printName();

    @Adaptive(&amp;quot;name&amp;quot;)
    void printName(URL url);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç¼–å†™Fruitæ¥å£çš„å®ç°ç±»ï¼šAppleã€Bananaã€Orange&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public class Apple implements Fruit {
    private static final String _name = &amp;quot;Apple&amp;quot;;

    @Override
    public void printName() {
        System.out.println(_name);
    }

    @Override
    public void printName(URL url) {
        this.printName();
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public class Banana implements Fruit {
    private static final String _name = &amp;quot;Banana&amp;quot;;

    @Override
    public void printName() {
        System.out.println(_name);
    }

    @Override
    public void printName(URL url) {
        this.printName();
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public class Orange implements Fruit {
    private static final String _name = &amp;quot;Orange&amp;quot;;

    @Override
    public void printName() {
        System.out.println(_name);
    }

    @Override
    public void printName(URL url) {
        this.printName();
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åœ¨resourcesæ·»åŠ ç›®å½•ï¼šMETA-INF/dubbo&lt;/p&gt;
&lt;p&gt;æ–°å»ºæ–‡ä»¶ï¼ˆdubboçº¦å®šæ–‡ä»¶åå¿…é¡»ä¸æ¥å£å…¨é™å®šåä¸€è‡´ï¼‰ï¼šcom.xx.xx.Fruit&lt;/p&gt;
&lt;p&gt;ç¼–è¾‘æ–‡ä»¶å†…å®¹å¹¶ä¿å­˜ï¼Œå»ºè®®ä»¥kvå½¢å¼ä¿å­˜ï¼Œå¦‚æœåƒOrangeçš„é…ç½®ï¼Œåˆ™Dubboé»˜è®¤ä¼šä»¥ç±»åâ€œorangeâ€ä½œä¸ºå®ç°ç±»çš„åç§°ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-properties&#34;&gt;apple=com.xx.xx.Apple
banana=com.xx.xx.Banana
# orange=com.xx.xx.Orange
com.xx.xx.Orange
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç¼–å†™Mainæ–¹æ³•æµ‹è¯•è¿è¡Œï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public static void main(String[] args) {
    ExtensionLoader&amp;lt;Fruit&amp;gt; FruitExtensionLoader = ExtensionLoader.getExtensionLoader(Fruit.class);

    // é»˜è®¤æ‰©å±•å¯¹è±¡ï¼Œç”±@SPIæ³¨è§£å£°æ˜
    Fruit fruit1 = FruitExtensionLoader.getDefaultExtension();
    fruit1.printName();
    System.out.println(&amp;quot;==============================&amp;quot;);

    Fruit fruit2 = FruitExtensionLoader.getExtension(&amp;quot;banana&amp;quot;);
    fruit2.printName();
    System.out.println(&amp;quot;==============================&amp;quot;);

    Map&amp;lt;String, String&amp;gt; parameters = new HashMap&amp;lt;&amp;gt;(2);
    // keyåœ¨@Adpativeä¸­æŒ‡å®šï¼Œå¦åˆ™é»˜è®¤å–ç±»åï¼Œä¾‹ï¼šfruit
    parameters.put(&amp;quot;name&amp;quot;, &amp;quot;orange&amp;quot;);
    URL url = new URL(&amp;quot;&amp;quot;, &amp;quot;&amp;quot;, 0, parameters);

    Fruit fruit3 = FruitExtensionLoader.getAdaptiveExtension();
    fruit3.printName(url);
    System.out.println(&amp;quot;==============================&amp;quot;);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ‰§è¡Œç»“æœï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;Apple
==============================
Banana
==============================
Orange
==============================
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æºç è§£æ&#34;&gt;æºç è§£æ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ä¸ºæ–¹ä¾¿ç†è§£ï¼Œæºç ä¼šåšç›¸åº”çš„ä¿®æ”¹å’Œçœç•¥&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;SPIæ ¸å¿ƒå…¥å£ExtensionLoader.getExtensionLoader()&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;// ExtensionLoaderç¤ºä¾‹ç¼“å­˜
private static final ConcurrentMap&amp;lt;Class&amp;lt;?&amp;gt;, ExtensionLoader&amp;lt;?&amp;gt;&amp;gt; EXTENSION_LOADERS = new ConcurrentHashMap&amp;lt;&amp;gt;();

******

public static &amp;lt;T&amp;gt; ExtensionLoader&amp;lt;T&amp;gt; getExtensionLoader(Class&amp;lt;T&amp;gt; type) {
    ******
    ExtensionLoader&amp;lt;T&amp;gt; loader = (ExtensionLoader&amp;lt;T&amp;gt;) EXTENSION_LOADERS.get(type);
    if (loader == null) {
        EXTENSION_LOADERS.putIfAbsent(type, new ExtensionLoader&amp;lt;T&amp;gt;(type));
        loader = (ExtensionLoader&amp;lt;T&amp;gt;) EXTENSION_LOADERS.get(type);
    }
    return loader;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;EXTENSION_LOADERSä¸ºExtensionLoaderå®ä¾‹çš„ç¼“å­˜ç¼“å­˜&lt;/p&gt;
&lt;p&gt;çœ‹ExtensionLoaderæ„é€ å‡½æ•°ï¼ŒExtensionFactoryå¯ä»¥è¿‘ä¼¼ç†è§£ä¸ºSpringä¸­çš„BeanFactoryï¼Œä½œä¸ºè·å–Extensionå®ä¾‹çš„å·¥å‚ï¼Œä¸”æ”¯æŒè‡ªé€‚åº”æ‰©å±•&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;private final ExtensionFactory objectFactory;

******

private ExtensionLoader(Class&amp;lt;?&amp;gt; type) {
    this.type = type;
    // ExtenFactoryæœ¬èº«ä¸éœ€è¦
    if (type == ExtensionFactory.class) {
      objectFactory = null;
    } else {
      // è·å–å¯¹è±¡å·¥å‚
      objectFactory = ExtensionLoader.getExtensionLoader(ExtensionFactory.class).getAdaptiveExtension();
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æŸ¥çœ‹æ¥å£ExtensionFactoryçš„å®ç°ç±»ï¼Œè¿™é‡Œå…ˆè®²è§£Dubboè‡ªå·±çš„SpiExtensionFactory&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public class SpiExtensionFactory implements ExtensionFactory {

    @Override
    public &amp;lt;T&amp;gt; T getExtension(Class&amp;lt;T&amp;gt; type, String name) {
        if (type.isInterface() &amp;amp;&amp;amp; type.isAnnotationPresent(SPI.class)) {
            ExtensionLoader&amp;lt;T&amp;gt; loader = ExtensionLoader.getExtensionLoader(type);
            // å¯åŠ è½½çš„æ‰©å±•ç±»ä¸ä¸ºç©ºï¼Œåˆ™åŠ è½½
            if (!loader.getSupportedExtensions().isEmpty()) {
                return loader.getAdaptiveExtension();
            }
        }
        return null;
    }

}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æŸ¥çœ‹loader.getSupportedExtensions()&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public Set&amp;lt;String&amp;gt; getSupportedExtensions() {
    Map&amp;lt;String, Class&amp;lt;?&amp;gt;&amp;gt; clazzes = getExtensionClasses();
    return Collections.unmodifiableSet(new TreeSet&amp;lt;&amp;gt;(clazzes.keySet()));
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿›å…¥getExtensionClasses()ï¼Œè¿™é‡Œä¸ºä¸€ä¸ªdouble check lockå®ç°çš„å•ä¾‹æ¨¡å¼&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;private final Holder&amp;lt;Map&amp;lt;String, Class&amp;lt;?&amp;gt;&amp;gt;&amp;gt; cachedClasses = new Holder&amp;lt;&amp;gt;();

******

private Map&amp;lt;String, Class&amp;lt;?&amp;gt;&amp;gt; getExtensionClasses() {
    Map&amp;lt;String, Class&amp;lt;?&amp;gt;&amp;gt; classes = cachedClasses.get();
    if (classes == null) {
        synchronized (cachedClasses) {
            classes = cachedClasses.get();
            if (classes == null) {
                classes = loadExtensionClasses();
                cachedClasses.set(classes);
            }
        }
    }
    return classes;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿›å…¥loadExtensionClasses()ï¼Œå¼€å§‹è£…è½½æ‰©å±•ç±»&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;private Map&amp;lt;String, Class&amp;lt;?&amp;gt;&amp;gt; loadExtensionClasses() {
    cacheDefaultExtensionName();

    Map&amp;lt;String, Class&amp;lt;?&amp;gt;&amp;gt; extensionClasses = new HashMap&amp;lt;&amp;gt;();

    for (LoadingStrategy strategy : strategies) {
        loadDirectory(extensionClasses, strategy.directory(), type.getName(), strategy.preferExtensionClassLoader(),
                strategy.overridden(), strategy.excludedPackages());
    }

    return extensionClasses;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;strategiesä½¿ç”¨jdkè‡ªå¸¦çš„ServiceLoaderè£…è½½å¤šç§dubbo spiè£…è½½æ–¹å¼ï¼Œæœ¬æ–‡ä¸»è¦çœ‹DubboLoadingStrategyï¼Œå…¶ä¸­å£°æ˜äº†é…ç½®æ–‡ä»¶è¯»å–è·¯å¾„ä¸º&amp;quot;META-INF/dubbo/&amp;quot;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public class DubboLoadingStrategy implements LoadingStrategy {

    @Override
    public String directory() {
        return &amp;quot;META-INF/dubbo/&amp;quot;;
    }

}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿›å…¥loadDirectory()ï¼Œè¿™é‡Œä¼šæ ¹æ®LoadingStrategyé…ç½®çš„æ–‡ä»¶ç›®å½•ï¼Œè§£æå¹¶è¯»å–&lt;/p&gt;
&lt;p&gt;æ ¸å¿ƒæ‰§è¡Œé¡ºåºä¸ºï¼šloadDirectory() &amp;gt; loadResource() &amp;gt; loadClass()&lt;/p&gt;
&lt;p&gt;åŠ è½½æ–‡ä»¶ç›®å½• &amp;gt; åŠ è½½spié…ç½®æ–‡ä»¶ &amp;gt; åŠ è½½é…ç½®æ–‡ä»¶ä¸­çš„æ‰©å±•å®ç°ç±»&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;private void loadDirectory(Map&amp;lt;String, Class&amp;lt;?&amp;gt;&amp;gt; extensionClasses, String dir, String type,
                           boolean extensionLoaderClassLoaderFirst, boolean overridden, String... excludedPackages) {
    String fileName = dir + type;
    ******
    
    loadResource(extensionClasses, classLoader, resourceURL, overridden, excludedPackages);
    
    ******
}

private void loadResource(Map&amp;lt;String, Class&amp;lt;?&amp;gt;&amp;gt; extensionClasses, ClassLoader classLoader,
                              java.net.URL resourceURL, boolean overridden, String... excludedPackages) {
    ******

    loadClass(extensionClasses, resourceURL, Class.forName(clazz, true, classLoader), name, overridden);

    ******
}

private void loadClass(Map&amp;lt;String, Class&amp;lt;?&amp;gt;&amp;gt; extensionClasses, java.net.URL resourceURL, Class&amp;lt;?&amp;gt; clazz, String name, boolean overridden) throws NoSuchMethodException {
        // @Adaptiveæ³¨è§£æ”¾åœ¨ç±»ä¸Šï¼Œåˆ™è¡¨ç¤ºç±»ä¸ºé»˜è®¤çš„åŠ¨æ€æ‰©å±•å®ç°
        if (clazz.isAnnotationPresent(Adaptive.class)) {
            // ç¼“å­˜åˆ°Map
            cacheAdaptiveClass(clazz, overridden);
        } else
        // æ„é€ å‡½æ•°å‚æ•°å”¯ä¸€ä¸”ä¸ºæ‰©å±•æ¥å£ç±»ï¼Œåˆ™è¡¨ç¤ºè¯¥ç±»ä¸ºåŒ…è£…ç±»ï¼ˆDubboçš„AOPå®ç°ï¼‰
        if (isWrapperClass(clazz)) {
            // ç¼“å­˜åˆ°Map
            cacheWrapperClass(clazz);
        } else {
            clazz.getConstructor();
            if (StringUtils.isEmpty(name)) {
                name = findAnnotationName(clazz);
            }
            // æ‰©å±•å®ç°å¯ä»¥æœ‰å¤šä¸ªåç§°ï¼Œä½¿ç”¨â€˜,â€˜åˆ†éš”
            String[] names = NAME_SEPARATOR.split(name);
            if (ArrayUtils.isNotEmpty(names)) {
                cacheActivateClass(clazz, names[0]);
                for (String n : names) {
                    cacheName(clazz, n);
                    // ç¼“å­˜åˆ°Map
                    saveInExtensionClass(extensionClasses, clazz, n, overridden);
                }
            }
        }
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åˆ°è¿™ï¼ŒDubbo SPIå·²ç»å®Œæˆäº†å¯¹æ‰©å±•æ¥å£å®ç°ç±»ï¼ˆæ³¨æ„æ˜¯classï¼Œæ­¤æ—¶ç±»è¿˜å¹¶æœªå®ä¾‹åŒ–ï¼‰çš„æ‰«æå’Œç¼“å­˜ï¼›&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥å›å¤´çœ‹ExtensionLoader#getDefaultExtension&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public T getDefaultExtension() {
    // ä¸Šæ–‡å·²è¯´æ˜ï¼Œå®Œæˆæ‰©å±•ç±»çš„æ‰«æå’Œç¼“å­˜
    getExtensionClasses();
    // cachedDefaultNameä¸º@SPIå£°æ˜
    if (StringUtils.isBlank(cachedDefaultName) || &amp;quot;true&amp;quot;.equals(cachedDefaultName)) {
        return null;
    }
    return getExtension(cachedDefaultName);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿›å…¥getExtensionï¼Œå¼€å§‹å®ä¾‹åŒ–æ‰©å±•å®ç°ç±»ï¼Œè¿™é‡ŒåŒæ ·ä½¿ç”¨äº†double check lockä¿è¯å•ä¾‹&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public T getExtension(String name, boolean wrap) {
    if (&amp;quot;true&amp;quot;.equals(name)) {
        return getDefaultExtension();
    }
    final Holder&amp;lt;Object&amp;gt; holder = getOrCreateHolder(name);
    Object instance = holder.get();
    if (instance == null) {
        synchronized (holder) {
            instance = holder.get();
            if (instance == null) {
                instance = createExtension(name, wrap);
                holder.set(instance);
            }
        }
    }
    return (T) instance;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿›å…¥createExtensionï¼Œå¼€å§‹åˆ›å»ºå®ä¾‹å¹¶å‡ºåˆå§‹åŒ–å®ä¾‹&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;private static final ConcurrentMap&amp;lt;Class&amp;lt;?&amp;gt;, Object&amp;gt; EXTENSION_INSTANCES = new ConcurrentHashMap&amp;lt;&amp;gt;(64);

******

private T createExtension(String name, boolean wrap) {
        Class&amp;lt;?&amp;gt; clazz = getExtensionClasses().get(name);
        T instance = (T) EXTENSION_INSTANCES.get(clazz);
        // ç¼“å­˜
        if (instance == null) {
            EXTENSION_INSTANCES.putIfAbsent(clazz, clazz.getDeclaredConstructor().newInstance());
            instance = (T) EXTENSION_INSTANCES.get(clazz);
        }
        // ä¾èµ–æ³¨å…¥
        injectExtension(instance);
        // åŒ…è£…ç±»ï¼ˆDubbo AOPï¼‰
        if (wrap) {
            List&amp;lt;Class&amp;lt;?&amp;gt;&amp;gt; wrapperClassesList = new ArrayList&amp;lt;&amp;gt;();
            if (cachedWrapperClasses != null) {
                wrapperClassesList.addAll(cachedWrapperClasses);
                wrapperClassesList.sort(WrapperComparator.COMPARATOR);
                Collections.reverse(wrapperClassesList);
            }

            if (CollectionUtils.isNotEmpty(wrapperClassesList)) {
                for (Class&amp;lt;?&amp;gt; wrapperClass : wrapperClassesList) {
                    Wrapper wrapper = wrapperClass.getAnnotation(Wrapper.class);
                    if (wrapper == null
                            || (ArrayUtils.contains(wrapper.matches(), name) &amp;amp;&amp;amp; !ArrayUtils.contains(wrapper.mismatches(), name))) {
                        instance = injectExtension((T) wrapperClass.getConstructor(type).newInstance(instance));
                    }
                }
            }
        }

        initExtension(instance);
        return instance;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æœ€åè·å–åˆ°æ‰©å±•æ¥å£çš„é»˜è®¤å®ç°ç±»å®ä¾‹&lt;/p&gt;
&lt;p&gt;ExtensionLoader#getExtension()ä¹Ÿæ˜¯åŒç†ï¼Œè¿™é‡Œå°†æ‰©å±•å®ç°ç±»çš„åç§°å·²å‚æ•°çš„å½¢å¼ä¼ å…¥ï¼Œè€Œä¸æ˜¯è¯»å–@SPIçš„å£°æ˜ï¼Œè¿™é‡Œä¸å†èµ˜è¿°&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;æ¥ä¸‹æ¥çœ‹getAdaptiveExtensionæ–¹æ³•ï¼Œæ ¹æ®å‚æ•°è·å–è‡ªé€‚åº”å®ç°ç±»ï¼Œè¿™é‡Œä»ç„¶ä½¿ç”¨äº†å•ä¾‹æ¨¡å¼&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;public T getAdaptiveExtension() {
    Object instance = cachedAdaptiveInstance.get();
    if (instance == null) {
        if (createAdaptiveInstanceError != null) {
            throw new IllegalStateException(&amp;quot;Failed to create adaptive instance: &amp;quot; +
                    createAdaptiveInstanceError.toString(),
                    createAdaptiveInstanceError);
        }

        synchronized (cachedAdaptiveInstance) {
            instance = cachedAdaptiveInstance.get();
            if (instance == null) {
                try {
                    instance = createAdaptiveExtension();
                    cachedAdaptiveInstance.set(instance);
                } catch (Throwable t) {
                    createAdaptiveInstanceError = t;
                    throw new IllegalStateException(&amp;quot;Failed to create adaptive instance: &amp;quot; + t.toString(), t);
                }
            }
        }
    }

    return (T) instance;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿›å…¥createAdaptiveExtension&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;private T createAdaptiveExtension() {
    try {
        // ä¾èµ–æ³¨å…¥
        return injectExtension(
          // è·å–è‡ªé€‚åº”ç±»
          (T) getAdaptiveExtensionClass()
          // å®ä¾‹åŒ–
          .newInstance()
        );
    } catch (Exception e) {
        throw new IllegalStateException(&amp;quot;Can&#39;t create adaptive extension &amp;quot; + type + &amp;quot;, cause: &amp;quot; + e.getMessage(), e);
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿›å…¥getAdaptiveExtensionClass&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;private Class&amp;lt;?&amp;gt; getAdaptiveExtensionClass() {
    // ä¸Šæ–‡å·²è¯´æ˜ï¼Œå®Œæˆæ‰©å±•ç±»çš„æ‰«æå’Œç¼“å­˜
    getExtensionClasses();
    if (cachedAdaptiveClass != null) {
        return cachedAdaptiveClass;
    }
    return cachedAdaptiveClass = createAdaptiveExtensionClass();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿›å…¥createAdaptiveExtensionClassï¼Œè¿™é‡ŒDubboä¸ºè¢«@Adaptiveå£°æ˜çš„æ–¹æ³•ç”Ÿæˆè‡ªé€‚åº”å®ç°ï¼Œå³è‡ªé€‚åº”ä»£ç†ç±»&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;private Class&amp;lt;?&amp;gt; createAdaptiveExtensionClass() {
    String code = new AdaptiveClassCodeGenerator(type, cachedDefaultName).generate();
    ClassLoader classLoader = findClassLoader();
    // Dubboé»˜è®¤ä½¿ç”¨javassistç±»ç¼–è¾‘å™¨ï¼Œç”Ÿæˆä»£ç†ç±»
    org.apache.dubbo.common.compiler.Compiler compiler = ExtensionLoader.getExtensionLoader(org.apache.dubbo.common.compiler.Compiler.class).getAdaptiveExtension();
    return compiler.compile(code, classLoader);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä»¥ä¸Šæ–‡Demoä¸­çš„Fruit#printName(URL url)ä¸ºä¾‹ï¼ŒDubboç”Ÿæˆçš„ä»£ç†ç±»æºç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public class Fruit$Adaptive implements com.xx.xx.Fruit {
    public void printName() {
        throw new UnsupportedOperationException(&amp;quot;The method public abstract void com.xx.xx.Fruit.printName() of interface com.xx.xxFruit is not adaptive method!&amp;quot;);
    }

    public void printName(org.apache.dubbo.common.URL arg0) {
        if (arg0 == null) throw new IllegalArgumentException(&amp;quot;url == null&amp;quot;);
        org.apache.dubbo.common.URL url = arg0;
        // æ ¹æ®urlä¸­çš„â€œnameâ€å‚æ•°åŠ¨æ€è·å–æ‰©å±•å®ä¾‹ï¼Œé»˜è®¤ä¸ºâ€œappleâ€
        String extName = url.getParameter(&amp;quot;name&amp;quot;, &amp;quot;apple&amp;quot;);
        if (extName == null)
            throw new IllegalStateException(&amp;quot;Failed to get extension (com.xx.xx.Fruit) name from url (&amp;quot; + url.toString() + &amp;quot;) use keys([name])&amp;quot;);
        com.xx.xx.Fruit extension = (com.xx.xx.Fruit) ExtensionLoader.getExtensionLoader(com.xx.xx.Fruit.class).getExtension(extName);
        extension.printName(arg0);
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åˆ°è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°Dubboçš„è‡ªé€‚åº”æ‰©å±•ï¼Œå…¶å®ç°æ–¹å¼è¿˜æ˜¯ä½¿ç”¨äº†ExtensionLoader.getExtensionLoader(Class).getExtension(name);&lt;/p&gt;
&lt;p&gt;å‚æ•°nameåˆ™æ˜¯ä»URLä¸­è·å–ï¼Œkeyåœ¨@Adaptiveæ³¨è§£ä¸­å£°æ˜ï¼Œvalueåˆ™åœ¨ä»£ç è¿è¡Œæ—¶åŠ¨æ€è¾“å…¥ï¼ŒDubboåˆ™ä¾é è¿™ä¸ªæœºåˆ¶å®ç°åŠ¨æ€è‡ªé€‚åº”æ‰©å±•ç±»åŠ è½½ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;æœ¬æ–‡åªæ˜¯ç®€å•ä»‹ç»äº†Dubbo SPIçš„ç®€å•ä½¿ç”¨å’Œä¸»è¦å®ç°åŸç†ï¼Œæºç ä¸­è¿˜æœ‰è¯¸å¤šç»†èŠ‚ï¼Œæ— æ³•å…¨é¢è¦†ç›–ï¼Œå¾…åç»­è¡¥å…… ......&lt;/p&gt;
">Dubbo SPI</a>
                </div>
            
                <div class="item">
                    <a class="result-title" style="opacity: 0;" href="https://blog.yhzdys.com/post/191003205847/"" data-c="
                    &lt;blockquote&gt;
&lt;p&gt;æ»‘åŠ¨æ—¶é—´çª—ç®—æ³•é€šå¸¸è¢«ç”¨äºç³»ç»Ÿé™æµï¼Œé™æµçš„ç›®çš„æ˜¯é€šè¿‡å¯¹å¹¶å‘è®¿é—®/è¯·æ±‚è¿›è¡Œé™é€Ÿï¼Œæˆ–è€…å¯¹ä¸€ä¸ªæ—¶é—´æ®µå†…çš„è¯·æ±‚è¿›è¡Œé™é€Ÿæ¥ä¿æŠ¤ç³»ç»Ÿï¼Œä¸€æ—¦è¾¾åˆ°é™åˆ¶é€Ÿç‡ç¨‹åºå¯ä»¥è¿›è¡Œæ‹’ç»ã€ç­‰å¾…æˆ–é™çº§ç­‰æ“ä½œã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!-- more --&gt;
&lt;p&gt;æ»‘åŠ¨æ—¶é—´çª—ç®—æ³•æ˜¯é’ˆå¯¹ &lt;em&gt;å›ºå®šçª—å£ç®—æ³•&lt;/em&gt; çš„æ”¹è‰¯ï¼Œä¸€å®šç¨‹åº¦ä¸Šç¼“è§£äº†å›ºå®šçª—å£ç®—æ³•ä¸‹çš„ä¸´ç•Œé—®é¢˜ï¼Œå®ƒå°†å•ä½æ—¶é—´å‘¨æœŸåˆ†ä¸ºnä¸ªå°å‘¨æœŸï¼Œåˆ†åˆ«è®°å½•æ¯ä¸ªå°å‘¨æœŸå†…æ¥å£çš„è®¿é—®æ¬¡æ•°ï¼Œå¹¶ä¸”æ ¹æ®æ—¶é—´æ»‘åŠ¨åˆ é™¤è¿‡æœŸçš„å°å‘¨æœŸã€‚&lt;/p&gt;
&lt;p&gt;å½“æ»‘åŠ¨æ—¶é—´çª—çš„æ ¼å­è¶Šå°ï¼Œé‚£ä¹ˆçª—å£çš„æ»šåŠ¨å°±è¶Šå¹³æ»‘ï¼Œé™æµå°±ä¼šè¶Šç²¾ç¡®ã€‚&lt;/p&gt;
&lt;h2 id=&#34;javaå®ç°&#34;&gt;Javaå®ç°&lt;/h2&gt;
&lt;p&gt;å®åœºæ™¯ä¸­é€šå¸¸ä½¿ç”¨Redisçš„æœ‰åºé›†åˆ(sorted set)æ¥å®ç°&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public class SlideWindowLimiter {
    // é™æµæ—¶é—´é•¿åº¦ï¼Œå•ä½ï¼šæ¯«ç§’
    private final long windowTime;
    // å•ä¸ªæ—¶é—´é•¿åº¦å†…é™æµæ¬¡æ•°
    private final int limitNum;
    private final List&amp;lt;Long&amp;gt; windows;

    public SlideWindowLimiter(long windowTime, int limitNum) {
        this.windowTime = windowTime;
        this.limitNum = limitNum;
        this.windows = new LinkedList&amp;lt;&amp;gt;();
    }

    public synchronized boolean outOfLimit() {
        // è·å–å½“å‰æ—¶é—´
        long now = System.currentTimeMillis();
        // å¦‚æœé˜Ÿåˆ—è¿˜æ²¡æ»¡ï¼Œåˆ™å…è®¸é€šè¿‡ï¼Œå¹¶æ·»åŠ å½“å‰æ—¶é—´æˆ³åˆ°é˜Ÿåˆ—å¼€å§‹ä½ç½®
        if (this.windows.size() &amp;lt; this.limitNum) {
            this.windows.add(0, now);
            return true;
        }

        // é˜Ÿåˆ—å·²æ»¡ï¼ˆè¾¾åˆ°é™åˆ¶æ¬¡æ•°ï¼‰ï¼Œåˆ™è·å–é˜Ÿåˆ—ä¸­æœ€æ—©æ·»åŠ çš„æ—¶é—´æˆ³
        int lastIndex = this.limitNum - 1;
        Long lastTime = this.windows.get(lastIndex);
        // ç”¨å½“å‰æ—¶é—´æˆ³ å‡å» æœ€æ—©æ·»åŠ çš„æ—¶é—´æˆ³
        if (this.windowTime &amp;gt;= now - lastTime) {
            // è‹¥ç»“æœå°äºç­‰äºtimeWindowï¼Œåˆ™è¯´æ˜åœ¨timeWindowå†…ï¼Œé€šè¿‡çš„æ¬¡æ•°å¤§äºlimit
            // ä¸å…è®¸é€šè¿‡
            return false;
        } else {
            // è‹¥ç»“æœå¤§äºæ—¶é—´çª—é•¿åº¦ï¼Œåˆ™è¯´æ˜åœ¨é™å®šæ—¶é—´å†…ï¼Œé€šè¿‡çš„æ¬¡æ•°å°äºç­‰äºlimit
            // å…è®¸é€šè¿‡ï¼Œå¹¶åˆ é™¤æœ€æ—©æ·»åŠ çš„æ—¶é—´æˆ³ï¼Œå°†å½“å‰æ—¶é—´æ·»åŠ åˆ°é˜Ÿåˆ—å¼€å§‹ä½ç½®
            this.windows.remove(lastIndex);
            this.windows.add(0, now);
            return true;
        }
    }

}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æµ‹è¯•&#34;&gt;æµ‹è¯•&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public static void main(String[] args) throws Exception {
        SlideWindowLimiter limiter = new SlideWindowLimiter(2 * 1000L, 3);
        System.out.println(limiter.outOfLimit());
        System.out.println(limiter.outOfLimit());
        Thread.sleep(990L);
        System.out.println(limiter.outOfLimit());
        System.out.println(limiter.outOfLimit());
        System.out.println(limiter.outOfLimit());
        Thread.sleep(990L);
        System.out.println(limiter.outOfLimit());
        System.out.println(limiter.outOfLimit());
        Thread.sleep(990L);
        System.out.println(limiter.outOfLimit());
        Thread.sleep(990L);
        System.out.println(limiter.outOfLimit());
        System.out.println(limiter.outOfLimit());
        System.out.println(limiter.outOfLimit());
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç»“æœ&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;true
true
true
false
false
false
false
true
true
true
false
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;ç¼ºç‚¹&#34;&gt;ç¼ºç‚¹&lt;/h2&gt;
&lt;p&gt;æ»‘åŠ¨æ—¶é—´çª—ç®—æ³•è™½ç„¶è§£å†³äº† &lt;em&gt;å›ºå®šçª—å£ç®—æ³•&lt;/em&gt; çš„ä¸´ç•Œé—®é¢˜ï¼Œä½†æ˜¯ç¨‹åºä¸€æ—¦åˆ°è¾¾é™æµæ¬¡æ•°åï¼Œç¨‹åºçš„æ“ä½œä¼šè¢«æ‹’ç»ï¼Œä¼šä¸¢å¤±ç›¸åº”çš„æ•°æ®ï¼Œæ‰€ä»¥è¿™ç§ç®—æ³•ä¸€èˆ¬ç”¨äºå¯¹å¤–çš„openAPIä¸­ï¼Œå¯¹äºç³»ç»Ÿå†…éƒ¨çš„ä¸šåŠ¡å®ç°ï¼Œå…¶å®å¹¶ä¸å‹å¥½ã€‚&lt;/p&gt;
">æ»‘åŠ¨æ—¶é—´çª—ç®—æ³•</a>
                </div>
            
                <div class="item">
                    <a class="result-title" style="opacity: 0;" href="https://blog.yhzdys.com/post/about/"" data-c="
                    &lt;p&gt;æ¬¢è¿æ¥åˆ°æˆ‘çš„åšå®¢ï¼Œå¾ˆé«˜å…´é‡è§ä½ ï¼ğŸ˜„&lt;/p&gt;
&lt;h2 id=&#34;å…³äºæˆ‘&#34;&gt;å…³äºæˆ‘ğŸ‘Œ&lt;/h2&gt;
&lt;p&gt;17å²åœ¨è¯»é«˜ä¸­ç”Ÿï¼Œä½åœ¨è¡£æŸœé‡Œã€‚&lt;/p&gt;
&lt;h2 id=&#34;è”ç³»æ–¹å¼&#34;&gt;è”ç³»æ–¹å¼ğŸ“&lt;/h2&gt;
&lt;p&gt;e-mail: yhzdys@foxmail.com&lt;br&gt;
github: https://github.com/yhzdys&lt;/p&gt;
">å…³äºæœ¬ç«™</a>
                </div>
            
        </div>
        <div class="page">
            <div id="page_ul"></div>
        </div>
    </div>
</div>
<script>
    !function () {
        let searchMask = document.querySelector('#search_mask');
        let result = document.querySelector('#result');
        let items = document.querySelectorAll('.item');
        let searchBox = document.querySelector('#search');
        let statCount = document.querySelector('#stat_count');
        let statTimes = document.querySelector('#stat_times');
        let pageUl = document.querySelector('#page_ul');
        let close = document.querySelector('#close');

        close.addEventListener('click', function () {
            searchMask.style = 'display: none;'
        })

        let finds = [];
        let contents = [];
        let pageSize = 10;
        items.forEach(item => {
            let a = item.querySelector('a');
            contents.push({
                title: a.innerText,
                details: a.dataset.c,
                link: a.href
            })
            item.remove();
        })

        function insertStr(soure, start, count) {
            let newStr = soure.substr(start, count);
            return soure.slice(0, start) + '<em>' + newStr + '</em>' + soure.slice(start + count);
        }

        pageUl.addEventListener('click', function (event) {
            let target = event.target;
            if (target.__proto__ === HTMLSpanElement.prototype) {
                appendResults(parseInt(target.dataset.i));
            }
        })

        function appendResults(index) {
            let htmlResult = '';
            let start = index || 0;
            let end = Math.min(start + pageSize, finds.length);
            for (let i = start; i < end; i++) {
                const current = finds[i];
                let html = current.title;
                let sum = 0;
                let positions = current.positions;
                positions.forEach(position => {
                    html = insertStr(html, position.start + sum, position.count);
                    sum += 9;
                })
                htmlResult += `<div class="item"><a class="result-title" href="${current.link}">${html}</a></div>`;
            }
            result.innerHTML = htmlResult;
            pageUl.innerHTML = '';
            let count = finds.length / pageSize;
            let lis = '';
            if (start !== 0) {
                lis += `<span class="fa fa-angle-left" data-i='${start - 1}'></span>`;
            }
            for (let i = 0; i < count; i++) {
                lis += `<span class='${i === start ? 'current' : ''}' data-i='${i}'>${i + 1}</span>`;
            }
            if (start + 1 < count) {
                lis += `<span class="fa fa-angle-right" data-i='${start + 1}'></span>`;
            }
            pageUl.innerHTML = lis;
        }

        function search(delay) {
            let timer = null
            return function () {
                clearTimeout(timer)
                timer = setTimeout(() => {
                    let start = Date.now();
                    let segments = searchBox.value.split(' ').filter(c => c != '');
                    if (segments.length <= 0) {
                        return;
                    }
                    finds = [];
                    let htmlResult = '';
                    contents.forEach(content => {
                        let title = content.title;
                        let positions = [];
                        let find = false;
                        segments.forEach((segment) => {
                            if (content.title.includes(segment)) {
                                find = true;
                                positions.push({
                                    start: content.title.indexOf(segment),
                                    count: segment.length
                                })
                            } else if (content.details.includes(segment)) {
                                find = true;
                            }
                        });
                        if (find) {
                            finds.push({
                                title: content.title,
                                link: content.link,
                                positions
                            });
                        }
                    })
                    appendResults(0);
                    statCount.textContent = finds.length;
                    statTimes.textContent = Date.now() - start;
                }, delay)
            }
        }

        searchBox.addEventListener('input', search(200));
    }()
</script>

<input hidden id="copy"/>
<script>
    !function () {
        let times = document.querySelectorAll('.publish-time');
        for (let i = 0; i < times.length; i++) {
            let date = times[i].dataset.t;
            let time = Math.floor((new Date().getTime() - new Date(date).getTime()) / 1000);
            if (time < 60) {
                str = time + 'ç§’ä¹‹å‰';
            } else if (time < 3600) {
                str = Math.floor(time / 60) + 'åˆ†é’Ÿä¹‹å‰';
            } else if (time >= 3600 && time < 86400) {
                str = Math.floor(time / 3600) + 'å°æ—¶ä¹‹å‰';
            } else if (time >= 86400 && time < 259200) {
                str = Math.floor(time / 86400) + 'å¤©ä¹‹å‰';
            } else {
                str = times[i].textContent;
            }
            times[i].textContent = str;
        }
    }();
</script>

<script>
    let language = '';
    if (language !== '') {
        let map = new Map();
        if (language === 'en') {
            map.set('search', 'Search');
            map.set('category', 'Categories');
            map.set('article', 'Articles');
            map.set('tag', 'Tags');
            map.set('top', 'Top');
            map.set('publish', 'published');
            map.set('minute', ' minutes');
            map.set('read-more', 'Read More');
            map.set('view', 'View');
            map.set('words', ' words');
            map.set('category-in', 'category in');
            map.set('preview', 'Meta');
            map.set('index', 'Toc');
            map.set('no-archives', "You haven't created yet");
            map.set('archives', " articles in total");
            map.set('cloud-tags', " tags in total");
            map.set('copyright', "Copyright: ");
            map.set('author', "Author: ");
            map.set('link', "Link: ");
            map.set('leave-message', "Leave a message");
            map.set('format', "Links Format");
            map.set('site-name', "Name: ");
            map.set('site-link', "Link: ");
            map.set('site-desc', "Desc: ");
            map.set('stat', " related results, taking ");
            map.set('stat-time', " ms");
            map.set('site-img', "Image: ");
        }

        if (map.size > 0) {
            let lanElems = document.querySelectorAll('.language');
            lanElems.forEach(elem => {
                let lan = elem.dataset.lan, text = map.get(lan);
                if (elem.__proto__ === HTMLInputElement.prototype) {
                    elem.placeholder = text
                } else {
                    if (elem.dataset.count) {
                        text = elem.dataset.count + text;
                    }
                    elem.textContent = text;
                }
            })
        }
    }

    window.Clipboard = (function (window, document, navigator) {
        var textArea,
            copy;

        function isOS() {
            return navigator.userAgent.match(/ipad|iphone/i);
        }

        function createTextArea(text) {
            textArea = document.createElement('textArea');
            textArea.value = text;
            textArea.style.width = 0;
            textArea.style.height = 0;
            textArea.clientHeight = 0;
            textArea.clientWidth = 0;
            document.body.appendChild(textArea);
        }

        function selectText() {
            var range,
                selection;

            if (isOS()) {
                range = document.createRange();
                range.selectNodeContents(textArea);
                selection = window.getSelection();
                selection.removeAllRanges();
                selection.addRange(range);
                textArea.setSelectionRange(0, 999999);
            } else {
                textArea.select();
            }
        }

        function copyToClipboard() {
            try {
                document.execCommand("Copy")
            } catch (err) {
                alert("å¤åˆ¶é”™è¯¯ï¼è¯·æ‰‹åŠ¨å¤åˆ¶ï¼")
            }
            document.body.removeChild(textArea);
        }

        copy = function (text) {
            createTextArea(text);
            selectText();
            copyToClipboard();
        };

        return {
            copy: copy
        };
    })(window, document, navigator);

    function copyCode(e) {
        if (e.srcElement.tagName === 'SPAN' && e.srcElement.classList.contains('copy-code')) {
            let code = e.currentTarget.querySelector('code');
            var text = code.innerText;
            if (e.srcElement.textContent === 'å¤åˆ¶æˆåŠŸ') {
                return;
            }
            e.srcElement.textContent = 'å¤åˆ¶æˆåŠŸ';
            (function (elem) {
                setTimeout(() => {
                    if (elem.textContent === 'å¤åˆ¶æˆåŠŸ') {
                        elem.textContent = 'å¤åˆ¶ä»£ç '
                    }
                }, 1000);
            })(e.srcElement)
            Clipboard.copy(text);
        }
    }

    let pres = document.querySelectorAll('pre');
    pres.forEach(pre => {
        let code = pre.querySelector('code');
        let copyElem = document.createElement('span');
        copyElem.classList.add('copy-code');
        copyElem.textContent = 'å¤åˆ¶ä»£ç ';
        pre.appendChild(copyElem);
        pre.onclick = copyCode
    })

</script>
<script src="/media/js/motion.js"></script>


    <script src="https://cdn.staticfile.org/smooth-scroll/16.1.3/smooth-scroll.polyfills.min.js"></script>
    <script>
        var scroll = new SmoothScroll('a[href*="#"]', {
            speed: 200
        });
    </script>






</html>